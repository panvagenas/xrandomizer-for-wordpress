ace.define("ace/ext/chromevox",["require","exports","module","ace/editor","ace/config"],function(aG,ao,ax){function bh(){return typeof cvox!="undefined"&&cvox&&cvox.Api}function aa(a){if(bh()){bi(a)}else{bk++;if(bk>=aJ){return}window.setTimeout(aa,500,a)}}var aq={};aq.SpeechProperty,aq.Cursor,aq.Token,aq.Annotation;var aC={rate:0.8,pitch:0.4,volume:0.9},ap={rate:1,pitch:0.5,volume:0.9},aw={rate:0.8,pitch:0.8,volume:0.9},an={rate:0.8,pitch:0.3,volume:0.9},aL={rate:0.8,pitch:0.7,volume:0.9},aF={rate:0.8,pitch:0.8,volume:0.9},az={punctuationEcho:"none",relativePitch:-0.6},aI="ALERT_NONMODAL",aD="ALERT_MODAL",av="INVALID_KEYPRESS",aH="insertMode",am="start",ay=[{substr:";",newSubstr:" semicolon "},{substr:":",newSubstr:" colon "}],aE={SPEAK_ANNOT:"annots",SPEAK_ALL_ANNOTS:"all_annots",TOGGLE_LOCATION:"toggle_location",SPEAK_MODE:"mode",SPEAK_ROW_COL:"row_col",TOGGLE_DISPLACEMENT:"toggle_displacement",FOCUS_TEXT:"focus_text"},ai="CONTROL + SHIFT ";aq.editor=null;var aK=null,ak={},bb=!1,aX=!1,aj=!1,aV=null,a2={},bd={},aA=function(a){return ai+String.fromCharCode(a)},a4=function(){var a=aq.editor.keyBinding.getKeyboardHandler();return a.$id==="ace/keyboard/vim"},bg=function(a){return aq.editor.getSession().getTokenAt(a.row,a.column+1)},a1=function(a){return aq.editor.getSession().getLine(a.row)},a3=function(a){ak[a.row]&&cvox.Api.playEarcon(aI),bb?(cvox.Api.stop(),aS(a),aY(bg(a)),a7(a.row,1)):a7(a.row,0)},aM=function(d){var b=a1(d),f=b.substr(d.column-1);d.column===0&&(f=" "+b);var c=/^\W(\w+)/,a=c.exec(f);return a!==null},bc={constant:{prop:aC},entity:{prop:aw},keyword:{prop:an},storage:{prop:aL},variable:{prop:aF},meta:{prop:ap,replace:[{substr:"</",newSubstr:" closing tag "},{substr:"/>",newSubstr:" close tag "},{substr:"<",newSubstr:" tag start "},{substr:">",newSubstr:" tag end "}]}},a0={prop:a0},a8=function(f,b){var g=f;for(var d=0;d<b.length;d++){var a=b[d],c=new RegExp(a.substr,"g");g=g.replace(c,a.newSubstr)}return g},bf=function(d,b,f){var c={};c.value="",c.type=d[b].type;for(var a=b;a<f;a++){c.value+=d[a].value}return c},aB=function(f){if(f.length<=1){return f}var b=[],g=0;for(var d=1;d<f.length;d++){var a=f[g],c=f[d];aU(a)!==aU(c)&&(b.push(bf(f,g,d)),g=d)}return b.push(bf(f,g,f.length)),b},ba=function(b){var a=aq.editor.getSession().getLine(b),c=/^\s*$/;return c.exec(a)!==null},a7=function(c,b){var d=aq.editor.getSession().getTokens(c);if(d.length===0||ba(c)){cvox.Api.playEarcon("EDITABLE_TEXT");return}d=aB(d);var a=d[0];d=d.filter(function(f){return f!==a}),ah(a,b),d.forEach(aY)},au=function(a){ah(a,0)},aY=function(a){ah(a,1)},aU=function(c){if(!c||!c.type){return}var a=c.type.split(".");if(a.length===0){return}var d=a[0],b=bc[d];return b?b:a0},ah=function(c,a){var d=aU(c),b=a8(c.value,ay);d.replace&&(b=a8(b,d.replace)),cvox.Api.speak(b,a,d.prop)},aS=function(b){var a=a1(b);cvox.Api.speak(a[b.column],1)},aR=function(c,a){var d=a1(a),b=d.substring(c.column,a.column);b=b.replace(/ /g," space "),cvox.Api.speak(b)},aT=function(b,a){if(Math.abs(b.column-a.column)!==1){var c=a1(a).length;if(a.column===0||a.column===c){a7(a.row,0);return}if(aM(a)){cvox.Api.stop(),aY(bg(a));return}}aS(a)},bl=function(b,a){aq.editor.selection.isEmpty()?aX?aR(b,a):aT(b,a):(aR(b,a),cvox.Api.speak("selected",1))},a6=function(b){if(aj){aj=!1;return}var a=aq.editor.selection.getCursor();a.row!==aK.row?a3(a):bl(aK,a),aK=a},a5=function(a){aq.editor.selection.isEmpty()&&cvox.Api.speak("unselected")},aZ=function(b){var a=b.data;switch(a.action){case"removeText":cvox.Api.speak(a.text,0,az),aj=!0;break;case"insertText":cvox.Api.speak(a.text,0),aj=!0}},a9=function(b){var a=b.row,c=b.column;return !ak[a]||!ak[a][c]},aP=function(d){ak={};for(var b=0;b<d.length;b++){var f=d[b],c=f.row,a=f.column;ak[c]||(ak[c]={}),ak[c][a]=f}},aO=function(b){var a=aq.editor.getSession().getAnnotations(),c=a.filter(a9);c.length>0&&cvox.Api.playEarcon(aI),aP(a)},bp=function(b){var a=b.type+" "+b.text+" on "+aQ(b.row,b.column);a=a.replace(";","semicolon"),cvox.Api.speak(a,1)},aW=function(b){var a=ak[b];for(var c in a){bp(a[c])}},aQ=function(b,a){return"row "+(b+1)+" column "+(a+1)},bo=function(){cvox.Api.speak(aQ(aK.row,aK.column))},ag=function(){for(var a in ak){aW(a)}},bj=function(){if(!a4()){return}switch(aq.editor.keyBinding.$data.state){case aH:cvox.Api.speak("Insert mode");break;case am:cvox.Api.speak("Command mode")}},al=function(){bb=!bb,bb?cvox.Api.speak("Speak location on row change enabled."):cvox.Api.speak("Speak location on row change disabled.")},ar=function(){aX=!aX,aX?cvox.Api.speak("Speak displacement on column changes."):cvox.Api.speak("Speak current character or word on column changes.")},be=function(b){if(b.ctrlKey&&b.shiftKey){var a=a2[b.keyCode];a&&a.func()}},bm=function(b,a){if(!a4()){return}var c=a.keyBinding.$data.state;if(c===aV){return}switch(c){case aH:cvox.Api.playEarcon(aD),cvox.Api.setKeyEcho(!0);break;case am:cvox.Api.playEarcon(aD),cvox.Api.setKeyEcho(!1)}aV=c},bn=function(b){var a=b.detail.customCommand,c=bd[a];c&&(c.func(),aq.editor.focus())},af=function(){var b=ab.map(function(c){return{desc:c.desc+aA(c.keyCode),cmd:c.cmd}}),a=document.querySelector("body");a.setAttribute("contextMenuActions",JSON.stringify(b)),a.addEventListener("ATCustomEvent",bn,!0)},aN=function(a){a.match?a7(aK.row,0):cvox.Api.playEarcon(av)},ad=function(){aq.editor.focus()},ab=[{keyCode:49,func:function(){aW(aK.row)},cmd:aE.SPEAK_ANNOT,desc:"Speak annotations on line"},{keyCode:50,func:ag,cmd:aE.SPEAK_ALL_ANNOTS,desc:"Speak all annotations"},{keyCode:51,func:bj,cmd:aE.SPEAK_MODE,desc:"Speak Vim mode"},{keyCode:52,func:al,cmd:aE.TOGGLE_LOCATION,desc:"Toggle speak row location"},{keyCode:53,func:bo,cmd:aE.SPEAK_ROW_COL,desc:"Speak row and column"},{keyCode:54,func:ar,cmd:aE.TOGGLE_DISPLACEMENT,desc:"Toggle speak displacement"},{keyCode:55,func:ad,cmd:aE.FOCUS_TEXT,desc:"Focus text"}],ae=function(){aq.editor=editor,editor.getSession().selection.on("changeCursor",a6),editor.getSession().selection.on("changeSelection",a5),editor.getSession().on("change",aZ),editor.getSession().on("changeAnnotation",aO),editor.on("changeStatus",bm),editor.on("findSearchBox",aN),editor.container.addEventListener("keydown",be),aK=editor.selection.getCursor()},bi=function(a){ae(),ab.forEach(function(b){a2[b.keyCode]=b,bd[b.cmd]=b}),a.on("focus",ae),a4()&&cvox.Api.setKeyEcho(!1),af()},bk=0,aJ=15,ac=aG("../editor").Editor;aG("../config").defineOptions(ac.prototype,"editor",{enableChromevoxEnhancements:{set:function(a){a&&aa(this)},value:!0}})});(function(){ace.require(["ace/ext/chromevox"],function(){})})();