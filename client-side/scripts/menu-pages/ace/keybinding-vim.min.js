ace.define("ace/keyboard/vim",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/dom","ace/lib/oop","ace/lib/keys","ace/lib/event","ace/search","ace/lib/useragent","ace/search_highlight","ace/commands/multi_select_commands","ace/multi_select"],function(bO,bu,bC){function bx(){function b(g){return typeof g!="object"?g+"":"line" in g?g.line+":"+g.ch:"anchor" in g?b(g.anchor)+"->"+b(g.head):Array.isArray(g)?"["+g.map(function(h){return b(h)})+"]":JSON.stringify(g)}var d="";for(var f=0;f<arguments.length;f++){var c=arguments[f],a=b(c);d+=a+"  "}console.log(d)}function br(a){return{row:a.line,column:a.ch}}function bE(a){return new bS(a.row,a.column)}function b3(d){var b=d.keyCode;if(bq.indexOf(b)!=-1){return}var f=d.ctrlKey||d.metaKey,c=bQ.keyNames[b];c=cr[c]||c;var a="";d.ctrlKey&&(a+="C-"),d.altKey&&(a+="A-");if(b5&&d.metaKey||!f&&d.shiftKey&&c.length<2){return}return d.shiftKey&&!/^[A-Za-z]$/.test(c)&&(a+="S-"),c.length==1&&(c=c.toLowerCase()),a+=c,a.length>1&&(a="<"+a+">"),a}function cd(b,a){var c=b3(a);if(!c){return}bQ.signal(b,"vim-keypress",c),bQ.Vim.handleKey(b,c,"user")&&bQ.e_stop(a)}function cv(c,a){var d=a.charCode||a.keyCode;if(a.ctrlKey||a.metaKey||a.altKey||a.shiftKey&&d<32){return}var b=String.fromCharCode(d);bQ.signal(c,"vim-keypress",b),bQ.Vim.handleKey(c,b,"user")&&bQ.e_stop(a)}function bG(a){a.setOption("disableInput",!0),a.setOption("showCursorWhenSelecting",!1),bQ.signal(a,"vim-mode-change",{mode:"normal"}),a.on("cursorActivity",ai),aH(a),bQ.on(a.getInputField(),"paste",ce(a)),a.on("keypress",cv),a.on("keydown",cd)}function cg(a){a.setOption("disableInput",!1),a.off("cursorActivity",ai),bQ.off(a.getInputField(),"paste",ce(a)),a.state.vim=null,a.off("keypress",cv),a.off("keydown",cd)}function cx(b,a){this==bQ.keyMap.vim&&bQ.rmClass(b.getWrapperElement(),"cm-fat-cursor"),(!a||a.attach!=cc)&&cg(b,!1)}function cc(b,a){this==bQ.keyMap.vim&&bQ.addClass(b.getWrapperElement(),"cm-fat-cursor"),(!a||a.attach!=cc)&&bG(b)}function ce(b){var a=b.state.vim;return a.onPasteFn||(a.onPasteFn=function(){a.insertMode||(b.setCursor(cH(b.getCursor(),0,1)),aq.enterInsertMode(b,{},a))}),a.onPasteFn}function cm(c,a){var d=[];for(var b=c;b<c+a;b++){d.push(String.fromCharCode(b))}return d}function b7(b,a){return a>=b.firstLine()&&a<=b.lastLine()}function b2(a){return/^[a-z]$/.test(a)}function bl(a){return"()[]{}".indexOf(a)!=-1}function b0(a){return bU.test(a)}function bZ(a){return/^[A-Z]$/.test(a)}function b1(a){return/^\s*$/.test(a)}function cI(b,a){for(var c=0;c<a.length;c++){if(a[c]==b){return !0}}return !1}function ch(c,a,d){if(a===undefined){throw Error("defaultValue is required")}d||(d="string");var b=c;typeof c=="string"?b={type:d,defaultValue:a}:c=b.name,cj[c]=b,b8(c,a)}function b8(c,a,d){var b=cj[c];if(!b){throw Error("Unknown option: "+c)}if(b.type=="boolean"){if(a&&a!==!0){throw Error("Invalid argument: "+c+"="+a)}a!==!1&&(a=!0)}b.value=a,b.set&&b.set(a,d)}function co(b){var a=cj[b];if(!a){throw Error("Unknown option: "+b)}return a.value}function a4(){this.latestRegister=undefined,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=undefined,this.lastInsertModeChanges=bW()}function aH(a){return a.state.vim||(a.state.vim={inputState:new bD,lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:!1,insertModeRepeat:undefined,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{}}),a.state.vim}function aZ(){cb={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:undefined,jumpList:bY(),macroModeState:new a4,lastChararacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new aV({}),searchHistoryController:new cM({}),exCommandHistoryController:new cM({})};for(var b in cj){var a=cj[b];a.value=a.defaultValue}}function bD(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null}function az(b,a){b.state.vim.inputState=new bD,bQ.signal(b,"vim-command-done",a)}function cA(b,a,c){this.clear(),this.keyBuffer=[b||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!a,this.blockwise=!!c}function aV(a){this.registers=a,this.unnamedRegister=a['"']=new cA,a["."]=new cA,a[":"]=new cA,a["/"]=new cA}function cM(){this.historyBuffer=[],this.iterator,this.initialPrefix=null}function bg(c,a){var d=[];for(var b=0;b<a;b++){d.push(c)}return d}function cD(f,b,g){var d=Math.min(Math.max(f.firstLine(),b.line),f.lastLine()),a=aG(f,d)-1;a=g?a+1:a;var c=Math.min(Math.max(0,b.ch),a);return bS(d,c)}function aL(b){var a={};for(var c in b){b.hasOwnProperty(c)&&(a[c]=b[c])}return a}function cH(b,a,c){return typeof a=="object"&&(c=a.ch,a=a.line),bS(b.line+a,b.ch+c)}function bX(b,a){return{line:a.line-b.line,ch:a.line-b.line}}function ah(g,k,d,b){var f,l=[],c=[];for(var j=0;j<k.length;j++){var h=k[j];if(d=="insert"&&h.context!="insert"||h.context&&h.context!=d||b.operator&&h.type=="action"||!(f=ak(g,h.keys))){continue}f=="partial"&&l.push(h),f=="full"&&c.push(h)}return{partial:l.length&&l,full:c.length&&c}}function ak(d,b){if(b.slice(-11)=="<character>"){var f=b.length-11,c=d.slice(0,f),a=b.slice(0,f);return c==a&&d.length>f?"full":a.indexOf(c)==0?"partial":!1}return d==b?"full":b.indexOf(d)==0?"partial":!1}function cP(b){var a=/^.*(<[\w\-]+>)$/.exec(b),c=a?a[1]:b.slice(-1);if(c.length>1){switch(c){case"<CR>":c="\n";break;case"<Space>":c=" ";break;default:}}return c}function cQ(b,a,c){return function(){for(var d=0;d<c;d++){a(b)}}}function cG(a){return bS(a.line,a.ch)}function aO(b,a){return b.ch==a.ch&&b.line==a.line}function aC(b,a){return b.line<a.line?!0:b.line==a.line&&b.ch<a.ch?!0:!1}function ad(b,a){return arguments.length>2&&(a=ad.apply(undefined,Array.prototype.slice.call(arguments,1))),aC(b,a)?b:a}function a7(b,a){return arguments.length>2&&(a=a7.apply(undefined,Array.prototype.slice.call(arguments,1))),aC(b,a)?a:b}function aU(d,b,f){var c=aC(d,b),a=aC(b,f);return c&&a}function aG(b,a){return b.getLine(a).length}function aY(a){return a.split("").reverse().join("")}function aa(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function av(a){return a.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function ay(d,b,f){var c=aG(d,b),a=(new Array(f-c+1)).join(" ");d.setCursor(bS(b,c)),d.replaceRange(a,d.getCursor())}function cC(K,x){var D=[],A=K.listSelections(),G=cG(K.clipPos(x)),z=!aO(x,G),C=K.getCursor("head"),q=al(A,C),N=aO(A[q].head,A[q].anchor),J=A.length-1,F=J-q>q?J:0,M=A[F].anchor,H=Math.min(M.line,G.line),B=Math.max(M.line,G.line),L=M.ch,k=G.ch,E=A[F].head.ch-L,I=k-L;E>0&&I<=0?(L++,z||k--):E<0&&I>=0?(L--,N||k++):E<0&&I==-1&&(L--,k++);for(var b=H;b<=B;b++){var j={anchor:new bS(b,L),head:new bS(b,k)};D.push(j)}return q=G.line==B?D.length-1:0,K.setSelections(D),x.ch=k,M.ch=L,M}function aK(f,b,g){var d=[];for(var a=0;a<g;a++){var c=cH(b,a,0);d.push({anchor:c,head:c})}f.setSelections(d,0)}function al(f,b,g){for(var d=0;d<f.length;d++){var a=g!="head"&&aO(f[d].anchor,b),c=g!="anchor"&&aO(f[d].head,b);if(a||c){return d}}return -1}function ac(d,b){var f=b.lastSelection,c=function(){var g=d.listSelections(),k=g[0],j=g[g.length-1],e=aC(k.anchor,k.head)?k.anchor:k.head,h=aC(j.anchor,j.head)?j.head:j.anchor;return[e,h]},a=function(){var B=d.getCursor(),e=d.getCursor(),m=f.visualBlock;if(m){var C=m.width,j=m.height;e=bS(B.line+j,B.ch+C);var A=[];for(var y=B.line;y<e.line;y++){var q=bS(y,B.ch),k=bS(y,e.ch),x={anchor:q,head:k};A.push(x)}d.setSelections(A)}else{var n=f.anchorMark.find(),g=f.headMark.find(),w=g.line-n.line,z=g.ch-n.ch;e={line:e.line+w,ch:w?e.ch:z+e.ch},f.visualLine&&(B=bS(B.line,0),e=bS(e.line,aG(d,e.line))),d.setSelection(B,e)}return[B,e]};return b.visualMode?c():a()}function b9(c,a){var d=a.sel.anchor,b=a.sel.head;a.lastPastedText&&(b=c.posFromIndex(c.indexFromPos(d)+a.lastPastedText.length),a.lastPastedText=null),a.lastSelection={anchorMark:c.setBookmark(d),headMark:c.setBookmark(b),anchor:cG(d),head:cG(b),visualMode:a.visualMode,visualLine:a.visualLine,visualBlock:a.visualBlock}}function a8(f,b,h){var d=f.state.vim.sel,a=d.head,c=d.anchor,g;return aC(h,b)&&(g=h,h=b,b=g),aC(a,c)?(a=ad(b,a),c=a7(c,h)):(c=ad(b,c),a=a7(a,h),a=cH(a,0,-1),a.ch==-1&&a.line!=f.firstLine()&&(a=bS(a.line-1,aG(f,a.line-1)))),[c,a]}function ag(d,b,f){var c=d.state.vim;b=b||c.sel;var f=f||c.visualLine?"line":c.visualBlock?"block":"char",a=cq(d,b,f);d.setSelections(a.ranges,a.primary),cy(d)}function cq(A,G,k,b){var x=cG(G.head),H=cG(G.anchor);if(k=="char"){var j=!b&&!aC(G.head,G.anchor)?1:0,F=aC(G.head,G.anchor)?1:0;return x=cH(G.head,0,j),H=cH(G.anchor,0,F),{ranges:[{anchor:H,head:x}],primary:0}}if(k=="line"){if(!aC(G.head,G.anchor)){H.ch=0;var D=A.lastLine();x.line>D&&(x.line=D),x.ch=aG(A,x.line)}else{x.ch=0,H.ch=aG(A,H.line)}return{ranges:[{anchor:H,head:x}],primary:0}}if(k=="block"){var z=Math.min(H.line,x.line),w=Math.min(H.ch,x.ch),C=Math.max(H.line,x.line),y=Math.max(H.ch,x.ch)+1,g=C-z+1,B=x.line==z?0:g-1,E=[];for(var q=0;q<g;q++){E.push({anchor:bS(z+q,w),head:bS(z+q,y)})}return{ranges:E,primary:B}}}function cu(b){var a=b.getCursor("head");return b.getSelection().length==1&&(a=ad(a,b.getCursor("anchor"))),a}function bj(b,a){var c=b.state.vim;a!==!1&&b.setCursor(cD(b,c.sel.head)),b9(b,c),c.visualMode=!1,c.visualLine=!1,c.visualBlock=!1,bQ.signal(b,"vim-mode-change",{mode:"normal"}),c.fakeCursor&&c.fakeCursor.clear()}function bb(f,b,g){var d=f.getRange(b,g);if(/\n\s*$/.test(d)){var a=d.split("\n");a.pop();var c;for(var c=a.pop();a.length>0&&c&&b1(c);c=a.pop()){g.line--,g.ch=0}c?(g.line--,g.ch=aG(f,g.line)):g.ch=0}}function bP(b,a,c){a.ch=0,c.ch=0,c.line++}function b6(b){if(!b){return 0}var a=b.search(/\S/);return a==-1?b.length:a}function bA(N,A,G,C,J){var B=cu(N),F=N.getLine(B.line),x=B.ch,Q=F.substring(x),M;J?M=Q.search(/\w/):M=Q.search(/\S/);if(M==-1){return null}x+=M,Q=F.substring(x);var I=F.substring(0,x),P;C?P=/^\S+/:/\w/.test(F.charAt(x))?P=/^\w+/:P=/^[^\w\s]+/;var K=P.exec(Q),D=x,O=x+K[0].length,q=aY(I),H=P.exec(q);H&&(D-=H[0].length);if(A){var L=F.substring(O),j=L.match(/^\s*/)[0].length;if(j>0){O+=j}else{var k=q.length-D,z=q.substring(k),b=z.match(/^\s*/)[0].length;D-=b}}return{start:bS(B.line,D),end:bS(B.line,O)}}function bf(b,a,c){aO(a,c)||cb.jumpList.add(b,a,c)}function ap(b,a){cb.lastChararacterSearch.increment=b,cb.lastChararacterSearch.forward=a.forward,cb.lastChararacterSearch.selectedCharacter=a.selectedCharacter}function aS(x,C,k,b){var q=cG(x.getCursor()),D=k?1:-1,j=k?x.lineCount():-1,B=q.ch,A=q.line,w=x.getLine(A),m={lineText:w,nextCh:w.charAt(B),lastCh:null,index:B,symb:b,reverseSymb:(k?{")":"(","}":"{"}:{"(":")","{":"}"})[b],forward:k,depth:0,curMoveThrough:!1},z=cL[b];if(!z){return q}var v=a2[z].init,g=a2[z].isComplete;v&&v(m);while(A!==j&&C){m.index+=D,m.nextCh=m.lineText.charAt(m.index);if(!m.nextCh){A+=D,m.lineText=x.getLine(A)||"";if(D>0){m.index=0}else{var y=m.lineText.length;m.index=y>0?y-1:0}m.nextCh=m.lineText.charAt(m.index)}g(m)&&(q.line=A,q.ch=m.index,C--)}return m.nextCh||m.curMoveThrough?bS(A,m.index):q}function a6(x,C,k,b,q){var D=C.line,j=C.ch,B=x.getLine(D),A=k?1:-1,w=b?ca:cs;if(q&&B==""){D+=A,B=x.getLine(D);if(!b7(x,D)){return null}j=k?0:B.length}for(;;){if(q&&B==""){return{from:0,to:0,line:D}}var m=A>0?B.length:-1,z=m,v=m;while(j!=m){var g=!1;for(var y=0;y<w.length&&!g;++y){if(w[y].test(B.charAt(j))){z=j;while(j!=m&&w[y].test(B.charAt(j))){j+=A}v=j,g=z!=v;if(z==C.ch&&D==C.line&&v==z+A){continue}return{from:Math.min(z,v+1),to:Math.max(z,v),line:D}}}g||(j+=A)}D+=A;if(!b7(x,D)){return null}B=x.getLine(D),j=A>0?0:B.length}throw new Error("The impossible happened.")}function aJ(x,C,k,b,q,D){var j=cG(C),B=[];(b&&!q||!b&&q)&&k++;var A=!b||!q;for(var w=0;w<k;w++){var m=a6(x,C,b,D,A);if(!m){var z=aG(x,x.lastLine());B.push(b?{line:x.lastLine(),from:z,to:z}:{line:0,from:0,to:0});break}B.push(m),C=bS(m.line,b?m.to-1:m.from)}var v=B.length!=k,g=B[0],y=B.pop();return b&&!q?(!v&&(g.from!=j.ch||g.line!=j.line)&&(y=B.pop()),bS(y.line,y.from)):b&&q?bS(y.line,y.to-1):!b&&q?(!v&&(g.to!=j.ch||g.line!=j.line)&&(y=B.pop()),bS(y.line,y.to)):bS(y.line,y.from)}function cl(g,k,d,b){var f=g.getCursor(),l=f.ch,c;for(var j=0;j<k;j++){var h=g.getLine(f.line);c=bL(l,h,b,d,!0);if(c==-1){return null}l=c}return bS(g.getCursor().line,c)}function a1(b,a){var c=b.getCursor().line;return cD(b,bS(c,a-1))}function aR(c,a,d,b){if(!cI(d,ck)){return}a.marks[d]&&a.marks[d].clear(),a.marks[d]=c.setBookmark(b)}function bL(f,b,g,d,a){var c;return d?(c=b.indexOf(g,f+1),c!=-1&&!a&&(c-=1)):(c=b.lastIndexOf(g,f-1),c!=-1&&!a&&(c+=1)),c}function aB(m,w,g,b){var j=w,x,d,v={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/}[g],q={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"}[g],k=m.getLine(j.line).charAt(j.ch),h=k===q?1:0;x=m.scanForBracket(bS(j.line,j.ch+h),-1,null,{bracketRegex:v}),d=m.scanForBracket(bS(j.line,j.ch+h),1,null,{bracketRegex:v});if(!x||!d){return{start:j,end:j}}x=x.pos,d=d.pos;if(x.line==d.line&&x.ch>d.ch||x.line>d.line){var p=x;x=d,d=p}return b?d.ch+=1:x.ch+=1,{start:x,end:d}}function cB(m,w,g,b){var j=cG(w),x=m.getLine(j.line),d=x.split(""),v,q,k,h,p=d.indexOf(g);j.ch<p?j.ch=p:p<j.ch&&d[j.ch]==g&&(q=j.ch,--j.ch);if(d[j.ch]==g&&!q){v=j.ch+1}else{for(k=j.ch;k>-1&&!v;k--){d[k]==g&&(v=k+1)}}if(v&&!q){for(k=v,h=d.length;k<h&&!q;k++){d[k]==g&&(q=k)}}return !v||!q?{start:j,end:j}:(b&&(--v,++q),{start:bS(j.line,v),end:bS(j.line,q)})}function aX(){}function cO(b){var a=b.state.vim;return a.searchState_||(a.searchState_=new aX)}function bw(d,b,f,c,a){d.openDialog?d.openDialog(b,c,{bottom:!0,value:a.value,onKeyDown:a.onKeyDown,onKeyUp:a.onKeyUp}):c(prompt(f,""))}function aF(c){var a=bi(c)||[];if(!a.length){return[]}var d=[];if(a[0]!==0){return}for(var b=0;b<a.length;b++){typeof a[b]=="number"&&d.push(c.substring(a[b]+1,a[b+1]))}return d}function bi(d){var b=!1,f=[];for(var c=0;c<d.length;c++){var a=d.charAt(c);!b&&a=="/"&&f.push(c),b=!b&&a=="\\"}return f}function be(g){var k="|(){",d="}",b=!1,f=[];for(var l=-1;l<g.length;l++){var c=g.charAt(l)||"",j=g.charAt(l+1)||"",h=j&&k.indexOf(j)!=-1;b?((c!=="\\"||!h)&&f.push(c),b=!1):c==="\\"?(b=!0,j&&d.indexOf(j)!=-1&&(h=!0),(!h||j==="\\")&&f.push(c)):(f.push(c),h&&j!=="\\"&&f.push("\\"))}return f.join("")}function au(f){var b=!1,g=[];for(var d=-1;d<f.length;d++){var a=f.charAt(d)||"",c=f.charAt(d+1)||"";b?(g.push(a),b=!1):a==="\\"?(b=!0,b0(c)||c==="$"?g.push("$"):c!=="/"&&c!=="\\"&&g.push("\\")):(a==="$"&&g.push("$"),g.push(a),c==="/"&&g.push("\\"))}return g.join("")}function cF(b){var a=new bQ.StringStream(b),c=[];while(!a.eol()){while(a.peek()&&a.peek()!="\\"){c.push(a.next())}a.match("\\/",!0)?c.push("/"):a.match("\\\\",!0)?c.push("\\"):c.push(a.next())}return c.join("")}function aN(g,k,d){var b=cb.registerController.getRegister("/");b.setText(g);if(g instanceof RegExp){return g}var f=bi(g),l,c;if(!f.length){l=g}else{l=g.substring(0,f[0]);var j=g.substring(f[0]);c=j.indexOf("i")!=-1}if(!l){return null}co("pcre")||(l=be(l)),d&&(k=/^[^A-Z]*$/.test(l));var h=new RegExp(l,k||c?"i":undefined);return h}function cK(b,a){b.openNotification?b.openNotification('<span style="color: red">'+a+"</span>",{bottom:!0,duration:5000}):alert(a)}function b4(b,a){var c="";return b&&(c+='<span style="font-family: monospace">'+b+"</span>"),c+='<input type="text"/> <span style="color: #888">',a&&(c+='<span style="color: #888">',c+=a,c+="</span>"),c}function am(c,a){var d=(a.prefix||"")+" "+(a.desc||""),b=b4(a.prefix,a.desc);bw(c,b,d,a.onClose,a)}function cR(d,b){if(d instanceof RegExp&&b instanceof RegExp){var f=["global","multiline","ignoreCase","source"];for(var c=0;c<f.length;c++){var a=f[c];if(d[a]!==b[a]){return !1}}return !0}return !1}function cS(f,b,g,d){if(!b){return}var a=cO(f),c=aN(b,!!g,!!d);if(!c){return}return aQ(f,c),cR(c,a.getQuery())?c:(a.setQuery(c),c)}function cJ(b){if(b.source.charAt(0)=="^"){var a=!0}return{token:function(d){if(a&&!d.sol()){d.skipToEnd();return}var c=d.match(b,!1);if(c){if(c[0].length==0){return d.next(),"searching"}if(!d.sol()){d.backUp(1);if(!b.exec(d.next()+c[0])){return d.next(),null}}return d.match(b),"searching"}while(!d.eol()){d.next();if(d.match(b,!1)){break}}},query:b}}function aQ(b,a){var c=cO(b).getOverlay();if(!c||a!=c.query){c&&b.removeOverlay(c),c=cJ(a),b.addOverlay(c),cO(b).setOverlay(c)}}function aE(c,a,d,b){return b===undefined&&(b=1),c.operation(function(){var f=c.getCursor(),g=c.getSearchCursor(d,f);for(var h=0;h<b;h++){var e=g.find(a);h==0&&e&&aO(g.from(),f)&&(e=g.find(a));if(!e){g=c.getSearchCursor(d,a?bS(c.lastLine()):bS(c.firstLine(),0));if(!g.find(a)){return}}}return g.from()})}function af(a){a.removeOverlay(cO(a).getOverlay()),cO(a).setOverlay(null)}function a9(b,a,c){return typeof b!="number"&&(b=b.line),a instanceof Array?cI(b,a):c?b>=a&&b<=c:b==a}function aW(b){var a=b.ace.renderer;return{top:a.getFirstFullyVisibleRow(),bottom:a.getLastFullyVisibleRow()}}function aA(z,E,j,b,w,F,g,D,B){function A(){z.operation(function(){while(!y){x(),d()}C()})}function x(){var a=z.getRange(F.from(),F.to()),c=a.replace(g,D);F.replace(c)}function d(){var a;while(a=F.findNext()&&a9(F.from(),b,w)){if(!j&&q&&F.from().line==q.line){continue}z.scrollIntoView(F.from(),30),z.setSelection(F.from(),F.to()),q=F.from(),y=!1;return}y=!0}function C(a){a&&a(),z.focus();if(q){z.setCursor(q);var c=z.state.vim;c.exMode=!1,c.lastHPos=c.lastHSPos=q.ch}B&&B()}function k(c,h,f){bQ.e_stop(c);var a=bQ.keyName(c);switch(a){case"Y":x(),d();break;case"N":d();break;case"A":var e=B;B=undefined,z.operation(A),B=e;break;case"L":x();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":C(f)}return y&&C(f),!0}z.state.vim.exMode=!0;var y=!1,q=F.from();d();if(y){cK(z,"No matches for "+g.source);return}if(!E){A(),B&&B();return}am(z,{prefix:"replace with <strong>"+D+"</strong> (y/n/a/q/l)",onKeyDown:k})}function cE(j){var m=j.state.vim,d=cb.macroModeState,b=cb.registerController.getRegister("."),g=d.isPlaying,p=d.lastInsertModeChanges,c=[];if(!g){var l=p.inVisualBlock?m.lastSelection.visualBlock.height:1,k=p.changes,c=[],h=0;while(h<k.length){c.push(k[h]),k[h] instanceof bk?h++:h+=l}p.changes=c,j.off("change",ba),bQ.off(j.getInputField(),"keydown",bc)}!g&&m.insertModeRepeat>1&&(bV(j,m,m.insertModeRepeat-1,!0),m.lastEditInputState.repeatOverride=m.insertModeRepeat),delete m.insertModeRepeat,m.insertMode=!1,j.setCursor(j.getCursor().line,j.getCursor().ch-1),j.setOption("keyMap","vim"),j.setOption("disableInput",!0),j.toggleOverwrite(!1),b.setText(p.changes.join("")),bQ.signal(j,"vim-mode-change",{mode:"normal"}),d.isRecording&&ae(d)}function aM(m,w,g,b){var j=cb.registerController.getRegister(b),x=j.keyBuffer,d=0;g.isPlaying=!0,g.replaySearchQueries=j.searchQueries.slice(0);for(var v=0;v<x.length;v++){var q=x[v],k,h;while(q){k=/<\w+-.+?>|<\w+>|./.exec(q),h=k[0],q=q.substring(k.index+h.length),bQ.Vim.handleKey(m,h,"macro");if(w.insertMode){var p=j.insertModeChanges[d++].changes;cb.macroModeState.lastInsertModeChanges.changes=p,cf(m,p,1),cE(m)}}}g.isPlaying=!1}function ao(c,a){if(c.isPlaying){return}var d=c.latestRegister,b=cb.registerController.getRegister(d);b&&b.pushText(a)}function ae(b){if(b.isPlaying){return}var a=b.latestRegister,c=cb.registerController.getRegister(a);c&&c.pushInsertModeChanges(b.lastInsertModeChanges)}function ci(c,a){if(c.isPlaying){return}var d=c.latestRegister,b=cb.registerController.getRegister(d);b&&b.pushSearchQuery(a)}function ba(d,b){var f=cb.macroModeState,c=f.lastInsertModeChanges;if(!f.isPlaying){while(b){c.expectCursorActivityForChange=!0;if(b.origin=="+input"||b.origin=="paste"||b.origin===undefined){var a=b.text.join("\n");c.changes.push(a)}b=b.next}}}function ai(c){var a=c.state.vim;if(a.insertMode){var d=cb.macroModeState;if(d.isPlaying){return}var b=d.lastInsertModeChanges;b.expectCursorActivityForChange?b.expectCursorActivityForChange=!1:b.changes=[]}else{c.curOp.isVimOp||cz(c,a)}a.visualMode&&cy(c)}function cy(c){var a=c.state.vim,d=cG(a.sel.head),b=cH(d,0,1);a.fakeCursor&&a.fakeCursor.clear(),a.fakeCursor=c.markText(d,b,{className:"cm-animate-fat-cursor"})}function cz(f,b){var g=f.getCursor("anchor"),d=f.getCursor("head");b.visualMode&&aO(d,g)&&aG(f,d.line)>d.ch?bj(f,!1):!b.visualMode&&!b.insertMode&&f.somethingSelected()&&(b.visualMode=!0,b.visualLine=!1,bQ.signal(f,"vim-mode-change",{mode:"visual"}));if(b.visualMode){var a=aC(d,g)?0:-1,c=aC(d,g)?-1:0;d=cH(d,0,a),g=cH(g,0,c),b.sel={anchor:g,head:d},aR(f,b,"<",ad(d,g)),aR(f,b,">",a7(d,g))}else{b.insertMode||(b.lastHPos=f.getCursor().ch)}}function bk(a){this.keyName=a}function bc(d){function b(){return f.changes.push(new bk(c)),!0}var a=cb.macroModeState,f=a.lastInsertModeChanges,c=bQ.keyName(d);(c.indexOf("Delete")!=-1||c.indexOf("Backspace")!=-1)&&bQ.lookupKey(c,"vim-insert",b)}function bV(j,m,d,b){function l(){p?bm.processAction(j,m,m.lastEditActionCommand):bm.evalInput(j,m)}function k(e){if(g.lastInsertModeChanges.changes.length>0){e=m.lastEditActionCommand?e:1;var a=g.lastInsertModeChanges;cf(j,a.changes,e)}}var g=cb.macroModeState;g.isPlaying=!0;var p=!!m.lastEditActionCommand,c=m.inputState;m.inputState=m.lastEditInputState;if(p&&m.lastEditActionCommand.interlaceInsertRepeat){for(var h=0;h<d;h++){l(),k(1)}}else{b||l(),k(d)}m.inputState=c,m.insertMode&&!b&&cE(j),g.isPlaying=!1}function cf(q,y,g){function b(a){return typeof a=="string"?bQ.commands[a](q):a(q),!0}var k=q.getCursor("head"),z=cb.macroModeState.lastInsertModeChanges.inVisualBlock;if(z){var d=q.state.vim,x=d.lastSelection,w=bX(x.anchor,x.head);aK(q,k,w.line+1),g=q.listSelections().length,q.setCursor(k)}for(var p=0;p<g;p++){z&&q.setCursor(cH(k,p,0));for(var j=0;j<y.length;j++){var v=y[j];if(v instanceof bk){bQ.lookupKey(v.keyName,"vim-insert",b)}else{var m=q.getCursor();q.replaceRange(v,m,m)}}}z&&q.setCursor(cH(k,0,1))}function b3(c,a,d){a.length>1&&a[0]=="n"&&(a=a.replace("numpad","")),a=cr[a]||a;var b="";return d.ctrlKey&&(b+="C-"),d.altKey&&(b+="A-"),d.shiftKey&&(b+="S-"),b+=a,b.length>1&&(b="<"+b+">"),b}function bh(b){var a=new b.constructor;return Object.keys(b).forEach(function(d){var c=b[d];Array.isArray(c)?c=c.slice():c&&typeof c=="object"&&c.constructor!=Object&&(c=bh(c)),a[d]=c}),b.sel&&(a.sel={head:b.sel.head&&cG(b.sel.head),anchor:b.sel.anchor&&cG(b.sel.anchor)}),a}function ar(f,b,h){var d=!1,a=bp.maybeInitVimState_(f),c=a.visualBlock||a.wasInVisualBlock;a.wasInVisualBlock&&!f.ace.inMultiSelectMode?a.wasInVisualBlock=!1:f.ace.inMultiSelectMode&&a.visualBlock&&(a.wasInVisualBlock=!0);if(b=="<Esc>"&&!a.insertMode&&!a.visualMode&&f.ace.inMultiSelectMode){f.ace.exitMultiSelectMode()}else{if(c||!f.ace.inMultiSelectMode||f.ace.inVirtualSelectionMode){d=bp.handleKey(f,b,h)}else{var g=bh(a);f.operation(function(){f.ace.forEachSelection(function(){var k=f.ace.selection;f.state.vim.lastHPos=k.$desiredColumn==null?k.lead.column:k.$desiredColumn;var l=f.getCursor("head"),j=f.getCursor("anchor"),e=aC(l,j)?0:-1,m=aC(l,j)?-1:0;l=cH(l,0,e),j=cH(j,0,m),f.state.vim.sel.head=l,f.state.vim.sel.anchor=j,d=bH(f,b,h),k.$desiredColumn=f.state.vim.lastHPos==-1?null:f.state.vim.lastHPos,f.virtualSelectionMode()&&(f.state.vim=bh(g))}),f.curOp.cursorActivity&&!d&&(f.curOp.cursorActivity=!1)},!0)}}return d}function aT(b,a){a.off("beforeEndOperation",aT);var c=a.state.cm.vimCmd;c&&a.execCommand(c.exec?c:c.name,c.args),a.curOp=a.prevOp}var bJ=bO("../range").Range,bv=bO("../lib/event_emitter").EventEmitter,bB=bO("../lib/dom"),bs=bO("../lib/oop"),bT=bO("../lib/keys"),bN=bO("../lib/event"),bF=bO("../search").Search,bR=bO("../lib/useragent"),bK=bO("../search_highlight").SearchHighlight,bz=bO("../commands/multi_select_commands");bO("../multi_select");var bQ=function(a){this.ace=a,this.state={},this.marks={},this.$uid=0,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this),this.onBeforeEndOperation=this.onBeforeEndOperation.bind(this),this.ace.on("change",this.onChange),this.ace.on("changeSelection",this.onSelectionChange),this.ace.on("beforeEndOperation",this.onBeforeEndOperation)};bQ.Pos=function(b,a){if(!(this instanceof bS)){return new bS(b,a)}this.line=b,this.ch=a},bQ.defineOption=function(b,a,c){},bQ.commands={redo:function(a){a.ace.redo()},undo:function(a){a.ace.undo()},newlineAndIndent:function(a){a.ace.insert("\n")}},bQ.keyMap={},bQ.addClass=bQ.rmClass=bQ.e_stop=function(){},bQ.keyName=function(b){if(b.key){return b.key}var a=bT[b.keyCode]||"";return a.length==1&&(a=a.toUpperCase()),a=bN.getModifierString(b).replace(/(^|-)\w/g,function(c){return c.toUpperCase()})+a,a},bQ.keyMap["default"]=function(a){return function(b){var c=b.ace.commands.commandKeyBinding[a.toLowerCase()];return c&&b.ace.execCommand(c)!==!1}},bQ.lookupKey=function a5(f,b,g){typeof b=="string"&&(b=bQ.keyMap[b]);var d=typeof b=="function"?b(f):b[f];if(d===!1){return"nothing"}if(d==="..."){return"multi"}if(d!=null&&g(d)){return"handled"}if(b.fallthrough){if(!Array.isArray(b.fallthrough)){return a5(f,b.fallthrough,g)}for(var a=0;a<b.fallthrough.length;a++){var c=a5(f,b.fallthrough[a],g);if(c){return c}}}},bQ.signal=function(b,a,c){return b._signal(a,c)},bQ.on=bN.addListener,bQ.off=bN.removeListener,function(){bs.implement(bQ.prototype,bv),this.destroy=function(){this.ace.off("change",this.onChange),this.ace.off("changeSelection",this.onSelectionChange),this.ace.off("beforeEndOperation",this.onBeforeEndOperation),this.removeOverlay()},this.virtualSelectionMode=function(){return this.ace.inVirtualSelectionMode&&this.ace.selection.index},this.onChange=function(f){var c=f.data;f={start:c.range.start,end:c.range.end,action:c.action,lines:c.lines||[c.text]};if(f.action[0]=="i"){var g={text:f.lines},d=this.curOp=this.curOp||{};d.changeHandlers||(d.changeHandlers=this._eventRegistry.change&&this._eventRegistry.change.slice());if(this.virtualSelectionMode()){return}d.lastChange?d.lastChange.next=d.lastChange=g:d.lastChange=d.change=g}this.$updateMarkers(f)},this.onSelectionChange=function(){var c=this.curOp=this.curOp||{};c.cursorActivityHandlers||(c.cursorActivityHandlers=this._eventRegistry.cursorActivity&&this._eventRegistry.cursorActivity.slice()),this.curOp.cursorActivity=!0,this.ace.inMultiSelectMode&&this.ace.keyBinding.removeKeyboardHandler(bz.keyboardHandler)},this.operation=function(g,d){if(!d&&this.curOp||d&&this.curOp&&this.curOp.force){return g()}(d||!this.ace.curOp)&&this.curOp&&this.onBeforeEndOperation();if(!this.ace.curOp){var h=this.ace.prevOp;this.ace.startOperation({command:{name:"vim",scrollIntoView:"cursor"}})}var f=this.curOp=this.curOp||{};this.curOp.force=d;var c=g();return this.ace.curOp&&this.ace.curOp.command.name=="vim"&&(this.ace.endOperation(),!f.cursorActivity&&!f.lastChange&&h&&(this.ace.prevOp=h)),(d||!this.ace.curOp)&&this.curOp&&this.onBeforeEndOperation(),c},this.onBeforeEndOperation=function(){var c=this.curOp;c&&(c.change&&this.signal("change",c.change,c),c&&c.cursorActivity&&this.signal("cursorActivity",null,c),this.curOp=null)},this.signal=function(g,d,h){var f=h?h[g+"Handlers"]:(this._eventRegistry||{})[g];if(!f){return}f=f.slice();for(var c=0;c<f.length;c++){f[c](this,d)}},this.firstLine=function(){return 0},this.lastLine=function(){return this.ace.session.getLength()-1},this.lineCount=function(){return this.ace.session.getLength()},this.setCursor=function(d,c){typeof d=="object"&&(c=d.ch,d=d.line),this.ace.inVirtualSelectionMode||this.ace.exitMultiSelectMode(),this.ace.selection.moveTo(d,c)},this.getCursor=function(d){var c=this.ace.selection,f=d=="anchor"?c.isEmpty()?c.lead:c.anchor:d=="head"||!d?c.lead:c.getRange()[d];return bE(f)},this.listSelections=function(d){var c=this.ace.multiSelect.rangeList.ranges;return !c.length||this.ace.inVirtualSelectionMode?[{anchor:this.getCursor("anchor"),head:this.getCursor("head")}]:c.map(function(f){return{anchor:this.clipPos(bE(f.cursor==f.end?f.start:f.end)),head:this.clipPos(bE(f.cursor))}},this)},this.setSelections=function(h,d){var j=this.ace.multiSelect,g=h.map(function(m){var k=br(m.anchor),o=br(m.head),l=bJ.comparePoints(k,o)<0?new bJ.fromPoints(k,o):new bJ.fromPoints(o,k);return l.cursor=bJ.comparePoints(l.start,o)?l.end:l.start,l});if(this.ace.inVirtualSelectionMode){this.ace.selection.fromOrientedRange(g[0]);return}d?g[d]&&g.push(g.splice(d,1)[0]):g=g.reverse(),j.toSingleRange(g[0].clone());var f=this.ace.session;for(var i=0;i<g.length;i++){var c=f.$clipRangeToDocument(g[i]);j.addRange(c)}},this.setSelection=function(f,c,g){var d=this.ace.selection;d.moveTo(f.line,f.ch),d.selectTo(c.line,c.ch),g&&g.origin=="*mouse"&&this.onBeforeEndOperation()},this.somethingSelected=function(c){return !this.ace.selection.isEmpty()},this.clipPos=function(d){var c=this.ace.session.$clipPositionToDocument(d.line,d.ch);return bE(c)},this.markText=function(c){return{clear:function(){},find:function(){}}},this.$updateMarkers=function(j){var p=j.action=="insert",g=j.start,c=j.end,q=(c.row-g.row)*(p?1:-1),d=(c.column-g.column)*(p?1:-1);p&&(c=g);for(var m in this.marks){var k=this.marks[m],i=bJ.comparePoints(k,g);if(i<0){continue}if(i===0&&p){if(k.bias!=1){k.bias==-1;continue}i=1}var h=p?i:bJ.comparePoints(k,c);if(h>0){k.row+=q,k.column+=k.row==c.row?d:0;continue}!p&&h<=0&&(k.row=g.row,k.column=g.column,h===0&&(k.bias=1))}};var b=function(f,c,g,d){this.cm=f,this.id=c,this.row=g,this.column=d,f.marks[this.id]=this};b.prototype.clear=function(){delete this.cm.marks[this.id]},b.prototype.find=function(){return bE(this)},this.setBookmark=function(c,e){var d=new b(this,this.$uid++,c.line,c.ch);if(!e||!e.insertLeft){d.$insertRight=!0}return this.marks[d.id]=d,d},this.moveH=function(d,c){if(c=="char"){var f=this.ace.selection;f.clearSelection(),f.moveCursorBy(0,d)}},this.findPosV=function(h,d,j,g){if(j=="line"){var c=this.ace.session.documentToScreenPosition(h.line,h.ch);g!=null&&(c.column=g),c.row+=d,c.row=Math.min(Math.max(0,c.row),this.ace.session.getScreenLength()-1);var f=this.ace.session.screenToDocumentPosition(c.row,c.column);return bE(f)}},this.charCoords=function(h,d){if(d=="div"||!d){var k=this.ace.session.documentToScreenPosition(h.line,h.ch);return{left:k.column,top:k.row}}if(d=="local"){var g=this.ace.renderer,k=this.ace.session.documentToScreenPosition(h.line,h.ch),c=g.layerConfig.lineHeight,f=g.layerConfig.characterWidth,j=c*k.row;return{left:k.column*f,top:j,bottom:j+c}}},this.coordsChar=function(h,d){var j=this.ace.renderer;if(d=="local"){var g=Math.max(0,Math.floor(h.top/j.lineHeight)),c=Math.max(0,Math.floor(h.left/j.characterWidth)),f=j.session.screenToDocumentPosition(g,c);return bE(f)}if(d=="div"){throw"not implemented"}},this.openDialog=function(){},this.getSearchCursor=function(h,l,f){var c=!1,g=!1;h instanceof RegExp&&!h.global&&(c=!h.ignoreCase,h=h.source,g=!0);var m=new bF;l.ch==undefined&&(l.ch=Number.MAX_VALUE);var d={row:l.line,column:l.ch},k=this,j=null;return{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){m.setOptions({needle:h,caseSensitive:c,wrap:!1,backwards:e,regExp:g,start:j||d});var i=m.find(k.ace.session);return i&&i.isEmpty()&&k.getLine(i.start.row).length==i.start.column&&(m.$options.start=i,i=m.find(k.ace.session)),j=i,j},from:function(){return j&&bE(j.start)},to:function(){return j&&bE(j.end)},replace:function(i){j&&(j.end=k.ace.session.doc.replace(j,i))}}},this.scrollTo=function(g,d){var h=this.ace.renderer,f=h.layerConfig,c=f.maxHeight;c-=(h.$size.scrollerHeight-h.lineHeight)*h.$scrollPastEnd,d!=null&&this.ace.session.setScrollTop(Math.max(0,Math.min(d,c))),g!=null&&this.ace.session.setScrollLeft(Math.max(0,Math.min(g,f.width)))},this.scrollInfo=function(){return 0},this.scrollIntoView=function(d,c){d&&this.ace.renderer.scrollCursorIntoView(br(d),null,c)},this.getLine=function(c){return this.ace.session.getLine(c)},this.getRange=function(d,c){return this.ace.session.getTextRange(new bJ(d.line,d.ch,c.line,c.ch))},this.replaceRange=function(d,c,f){return f||(f=c),this.ace.session.replace(new bJ(c.line,c.ch,f.line,f.ch),d)},this.replaceSelections=function(f){var c=this.ace.selection;if(this.ace.inVirtualSelectionMode){this.ace.session.replace(c.getRange(),f[0]||"");return}c.inVirtualSelectionMode=!0;var g=c.rangeList.ranges;g.length||(g=[this.ace.multiSelect.getRange()]);for(var d=g.length;d--;){this.ace.session.replace(g[d],f[d]||"")}c.inVirtualSelectionMode=!1},this.getSelection=function(){return this.ace.getSelectedText()},this.getSelections=function(){return this.listSelections().map(function(c){return this.getRange(c.anchor,c.head)},this)},this.getInputField=function(){return this.ace.textInput.getElement()},this.getWrapperElement=function(){return this.ace.containter};var a={indentWithTabs:"useSoftTabs",indentUnit:"tabSize",firstLineNumber:"firstLineNumber"};this.setOption=function(c,d){this.state[c]=d;switch(c){case"indentWithTabs":c=a[c],d=!d;break;default:c=a[c]}c&&this.ace.setOption(c,d)},this.getOption=function(d,f){var c=a[d];c&&(f=this.ace.getOption(c));switch(d){case"indentWithTabs":return d=a[d],!f}return c?f:this.state[d]},this.toggleOverwrite=function(c){return this.state.overwrite=c,this.ace.setOverwrite(c)},this.addOverlay=function(f){if(!this.$searchHighlight||!this.$searchHighlight.session){var c=new bK(null,"ace_highlight-marker","text"),g=this.ace.session.addDynamicMarker(c);c.id=g.id,c.session=this.ace.session,c.destroy=function(h){c.session.off("change",c.updateOnChange),c.session.off("changeEditor",c.destroy),c.session.removeMarker(c.id),c.session=null},c.updateOnChange=function(h){h=h.data.range;var i=h.start.row;i==h.end.row?c.cache[i]=undefined:c.cache.splice(i,c.cache.length)},c.session.on("changeEditor",c.destroy),c.session.on("change",c.updateOnChange)}var d=new RegExp(f.query.source,"gmi");console.log(d),this.$searchHighlight=f.highlight=c,this.$searchHighlight.setRegexp(d),this.ace.renderer.updateBackMarkers()},this.removeOverlay=function(c){this.$searchHighlight&&this.$searchHighlight.session&&this.$searchHighlight.destroy()},this.getScrollInfo=function(){var d=this.ace.renderer,c=d.layerConfig;return{left:d.scrollLeft,top:d.scrollTop,height:c.maxHeight,width:c.width,clientHeight:c.height,clientWidth:c.width}},this.getValue=function(){return this.ace.getValue()},this.setValue=function(c){return this.ace.setValue(c)},this.getTokenTypeAt=function(d){var c=this.ace.session.getTokenAt(d.line,d.ch);return c&&/comment|string/.test(c.type)?"string":""},this.findMatchingBracket=function(d){var c=this.ace.session.findMatchingBracket(br(d));return{to:c&&bE(c)}},this.indentLine=function(d,c){c===!0?this.ace.session.indentRows(d,d,"	"):c===!1&&this.ace.session.outdentRows(new bJ(d,0,d,0))},this.indexFromPos=function(c){return this.ace.session.doc.positionToIndex(br(c))},this.posFromIndex=function(c){return bE(this.ace.session.doc.indexToPosition(c))},this.focus=function(c){return this.ace.focus()},this.blur=function(c){return this.ace.blur()},this.defaultTextHeight=function(c){return this.ace.renderer.layerConfig.lineHeight},this.scanForBracket=function(h,d,j,g){var c=g.bracketRegex.source;if(d==1){var f=this.ace.session.$findClosingBracket(c.slice(1,2),br(h),/paren|text/)}else{var f=this.ace.session.$findOpeningBracket(c.slice(-2,-1),{row:h.line,column:h.ch+1},/paren|text/)}return f&&{pos:bE(f)}},this.refresh=function(){return this.ace.resize(!0)}}.call(bQ.prototype);var bM=bQ.StringStream=function(b,a){this.pos=this.start=0,this.string=b,this.tabSize=a||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};bM.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||undefined},next:function(){if(this.pos<this.string.length){return this.string.charAt(this.pos++)}},eat:function(b){var a=this.string.charAt(this.pos);if(typeof b=="string"){var c=a==b}else{var c=a&&(b.test?b.test(a):b(a))}if(c){return ++this.pos,a}},eatWhile:function(b){var a=this.pos;while(this.eat(b)){}return this.pos>a},eatSpace:function(){var a=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++this.pos}return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){var a=this.string.indexOf(b,this.pos);if(a>-1){return this.pos=a,!0}},backUp:function(a){this.pos-=a},column:function(){throw"not implemented"},indentation:function(){throw"not implemented"},match:function(f,b,g){if(typeof f!="string"){var c=this.string.slice(this.pos).match(f);return c&&c.index>0?null:(c&&b!==!1&&(this.pos+=c[0].length),c)}var d=function(h){return g?h.toLowerCase():h},a=this.string.substr(this.pos,f.length);if(d(a)==d(f)){return b!==!1&&(this.pos+=f.length),!0}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(b,a){this.lineStart+=b;try{return a()}finally{this.lineStart-=b}}},bQ.defineExtension=function(b,a){bQ.prototype[b]=a},bB.importCssString(".normal-mode .ace_cursor{  border: 0!important;  background-color: red;  opacity: 0.5;}.ace_dialog {  position: absolute;  left: 0; right: 0;  background: white;  z-index: 15;  padding: .1em .8em;  overflow: hidden;  color: #333;}.ace_dialog-top {  border-bottom: 1px solid #eee;  top: 0;}.ace_dialog-bottom {  border-top: 1px solid #eee;  bottom: 0;}.ace_dialog input {  border: none;  outline: none;  background: transparent;  width: 20em;  color: inherit;  font-family: monospace;}","vimMode"),function(){function b(g,d,h){var f=g.ace.container,c;return c=f.appendChild(document.createElement("div")),h?c.className="ace_dialog ace_dialog-bottom":c.className="ace_dialog ace_dialog-top",typeof d=="string"?c.innerHTML=d:c.appendChild(d),c}function a(d,c){d.state.currentNotificationClose&&d.state.currentNotificationClose(),d.state.currentNotificationClose=c}bQ.defineExtension("openDialog",function(e,c,h){function k(f){if(typeof f=="string"){j.value=f}else{if(d){return}d=!0,p.parentNode.removeChild(p),m.focus(),h.onClose&&h.onClose(p)}}if(this.virtualSelectionMode()){return}h||(h={}),a(this,null);var p=b(this,e,h.bottom),d=!1,m=this,j=p.getElementsByTagName("input")[0],g;if(j){h.value&&(j.value=h.value,j.select()),h.onInput&&bQ.on(j,"input",function(f){h.onInput(f,j.value,k)}),h.onKeyUp&&bQ.on(j,"keyup",function(f){h.onKeyUp(f,j.value,k)}),bQ.on(j,"keydown",function(f){if(h&&h.onKeyDown&&h.onKeyDown(f,j.value,k)){return}if(f.keyCode==27||h.closeOnEnter!==!1&&f.keyCode==13){j.blur(),bQ.e_stop(f),k()}f.keyCode==13&&c(j.value)}),h.closeOnBlur!==!1&&bQ.on(j,"blur",k),j.focus()}else{if(g=p.getElementsByTagName("button")[0]){bQ.on(g,"click",function(){k(),m.focus()}),h.closeOnBlur!==!1&&bQ.on(g,"blur",k),g.focus()}}return k}),bQ.defineExtension("openNotification",function(j,g){function c(){if(f){return}f=!0,clearTimeout(h),e.parentNode.removeChild(e)}if(this.virtualSelectionMode()){return}a(this,c);var e=b(this,j,g&&g.bottom),f=!1,h,d=g&&typeof g.duration!="undefined"?g.duration:5000;return bQ.on(e,"click",function(i){bQ.e_preventDefault(i),c()}),d&&(h=setTimeout(c,d)),c})}();var bo=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"xi",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"dcc",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0}},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],bS=bQ.Pos,bq=[16,17,18,91],cr={Enter:"CR",Backspace:"BS",Delete:"Del"},b5=/Mac/.test(navigator.platform),bp=function(){return aP};bQ.defineOption("vimMode",!1,function(b,a,c){a&&b.getOption("keyMap")!="vim"?b.setOption("keyMap","vim"):!a&&c!=bQ.Init&&/^vim/.test(b.getOption("keyMap"))&&b.setOption("keyMap","default")});var bU=/[\d]/,cs=[/\w/,/[^\w\s]/],ca=[/\S/],cw=cm(65,26),bI=cm(97,26),cp=cm(48,10),ck=[].concat(cw,bI,cp,["<",">"]),by=[].concat(cw,bI,cp,["-",'"',".",":","/"]),cj={},bY=function(){function c(k,n,j){function i(s){var l=++b%f,q=a[l];q&&q.clear(),a[l]=k.setBookmark(s)}var e=b%f,m=a[e];if(m){var p=m.find();p&&!aO(p,n)&&i(n)}else{i(n)}i(j),h=b,d=b-f+1,d<0&&(d=0)}function g(k,n){b+=n,b>h?b=h:b<d&&(b=d);var j=a[(f+b)%f];if(j&&!j.find()){var i=n>0?1:-1,m,e=k.getCursor();do{b+=i,j=a[(f+b)%f];if(j&&(m=j.find())&&!aO(e,m)){break}}while(b<h&&b>d)}return j}var f=100,b=-1,h=0,d=0,a=new Array(f);return{cachedCursor:undefined,add:c,move:g}},bW=function(a){return a?{changes:a.changes,expectCursorActivityForChange:a.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};a4.prototype={exitMacroRecordMode:function(){var a=cb.macroModeState;a.onRecordingDone&&a.onRecordingDone(),a.onRecordingDone=undefined,a.isRecording=!1},enterMacroRecordMode:function(b,a){var c=cb.registerController.getRegister(a);c&&(c.clear(),this.latestRegister=a,b.openDialog&&(this.onRecordingDone=b.openDialog("(recording)["+a+"]",null,{bottom:!0})),this.isRecording=!0)}};var cb,aw,aP={buildKeyMap:function(){},getRegisterController:function(){return cb.registerController},resetVimGlobalState_:aZ,getVimGlobalState_:function(){return cb},maybeInitVimState_:aH,InsertModeKey:bk,map:function(b,a,c){ax.map(b,a,c)},unmap:function(b,a){ax.unmap(b,a)},setOption:b8,getOption:co,defineOption:ch,defineEx:function(b,a,c){if(b.indexOf(a)!==0){throw new Error('(Vim.defineEx) "'+a+'" is not a prefix of "'+b+'", command not registered')}ab[b]=c,ax.commandMap_[a]={name:b,shortName:a,type:"api"}},handleKey:function(g,k,d){function f(){var a=cb.macroModeState;if(a.isRecording){if(k=="q"){return a.exitMacroRecordMode(),az(g),!0}d!="mapping"&&ao(a,k)}}function l(){if(k=="<Esc>"){return az(g),b.visualMode?bj(g):b.insertMode&&cE(g),!0}}function c(e){var a;while(e){a=/<\w+-.+?>|<\w+>|./.exec(e),k=a[0],e=e.substring(a.index+k.length),bQ.Vim.handleKey(g,k,"mapping")}}function j(){if(l()){return !0}var r=b.inputState.keyBuffer=b.inputState.keyBuffer+k,p=k.length==1,o=bm.matchCommand(r,bo,b.inputState,"insert");while(r.length>1&&o.type!="full"){var r=b.inputState.keyBuffer=r.slice(1),m=bm.matchCommand(r,bo,b.inputState,"insert");m.type!="none"&&(o=m)}if(o.type=="none"){return az(g),!1}if(o.type=="partial"){return aw&&window.clearTimeout(aw),aw=window.setTimeout(function(){b.insertMode&&b.inputState.keyBuffer&&az(g)},co("insertModeEscKeysTimeout")),!p}aw&&window.clearTimeout(aw);if(p){var q=g.getCursor();g.replaceRange("",cH(q,0,-(r.length-1)),q,"+input")}az(g);var e=o.command;return e.type=="keyToKey"?c(e.toKeys):bm.processCommand(g,b,e),!0}function h(){if(f()||l()){return !0}var p=b.inputState.keyBuffer=b.inputState.keyBuffer+k;if(/^[1-9]\d*$/.test(p)){return !0}var m=/^(\d*)(.*)$/.exec(p);if(!m){return az(g),!1}var i=b.visualMode?"visual":"normal",o=bm.matchCommand(m[2]||m[1],bo,b.inputState,i);if(o.type=="none"){return az(g),!1}if(o.type=="partial"){return !0}b.inputState.keyBuffer="";var e=o.command,m=/^(\d*)(.*)$/.exec(p);return m[1]&&m[1]!="0"&&b.inputState.pushRepeatDigit(m[1]),e.type=="keyToKey"?c(e.toKeys):bm.processCommand(g,b,e),!0}var b=aH(g);return g.operation(function(){g.curOp.isVimOp=!0;try{return b.insertMode?j():h()}catch(a){throw g.state.vim=undefined,aH(g),a}})},handleEx:function(b,a){ax.processCommand(b,a)}};bD.prototype.pushRepeatDigit=function(a){this.operator?this.motionRepeat=this.motionRepeat.concat(a):this.prefixRepeat=this.prefixRepeat.concat(a)},bD.prototype.getRepeat=function(){var a=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){a=1,this.prefixRepeat.length>0&&(a*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(a*=parseInt(this.motionRepeat.join(""),10))}return a},cA.prototype={setText:function(b,a,c){this.keyBuffer=[b||""],this.linewise=!!a,this.blockwise=!!c},pushText:function(b,a){a&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0),this.keyBuffer.push(b)},pushInsertModeChanges:function(a){this.insertModeChanges.push(bW(a))},pushSearchQuery:function(a){this.searchQueries.push(a)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}},aV.prototype={pushText:function(f,b,h,d,a){d&&h.charAt(0)=="\n"&&(h=h.slice(1)+"\n"),d&&h.charAt(h.length-1)!=="\n"&&(h+="\n");var c=this.isValidRegister(f)?this.getRegister(f):null;if(!c){switch(b){case"yank":this.registers[0]=new cA(h,d,a);break;case"delete":case"change":h.indexOf("\n")==-1?this.registers["-"]=new cA(h,d):(this.shiftNumericRegisters_(),this.registers[1]=new cA(h,d))}this.unnamedRegister.setText(h,d,a);return}var g=bZ(f);g?c.pushText(h,d):c.setText(h,d,a),this.unnamedRegister.setText(c.toString(),d)},getRegister:function(a){return this.isValidRegister(a)?(a=a.toLowerCase(),this.registers[a]||(this.registers[a]=new cA),this.registers[a]):this.unnamedRegister},isValidRegister:function(a){return a&&cI(a,by)},shiftNumericRegisters_:function(){for(var a=9;a>=2;a--){this.registers[a]=this.getRegister(""+(a-1))}}},cM.prototype={nextMatch:function(f,b){var h=this.historyBuffer,d=b?-1:1;this.initialPrefix===null&&(this.initialPrefix=f);for(var a=this.iterator+d;b?a>=0:a<h.length;a+=d){var c=h[a];for(var g=0;g<=c.length;g++){if(this.initialPrefix==c.substring(0,g)){return this.iterator=a,c}}}if(a>=h.length){return this.iterator=h.length,this.initialPrefix}if(a<0){return f}},pushInput:function(b){var a=this.historyBuffer.indexOf(b);a>-1&&this.historyBuffer.splice(a,1),b.length&&this.historyBuffer.push(b)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var bm={matchCommand:function(g,c,j,f){var b=ah(g,c,f,j);if(!b.full&&!b.partial){return{type:"none"}}if(!b.full&&b.partial){return{type:"partial"}}var d;for(var h=0;h<b.full.length;h++){var a=b.full[h];d||(d=a)}return d.keys.slice(-11)=="<character>"&&(j.selectedCharacter=cP(g)),{type:"full",command:d}},processCommand:function(b,a,c){a.inputState.repeatOverride=c.repeatOverride;switch(c.type){case"motion":this.processMotion(b,a,c);break;case"operator":this.processOperator(b,a,c);break;case"operatorMotion":this.processOperatorMotion(b,a,c);break;case"action":this.processAction(b,a,c);break;case"search":this.processSearch(b,a,c),az(b);break;case"ex":case"keyToEx":this.processEx(b,a,c),az(b);break;default:}},processMotion:function(b,a,c){a.inputState.motion=c.motion,a.inputState.motionArgs=aL(c.motionArgs),this.evalInput(b,a)},processOperator:function(c,a,d){var b=a.inputState;if(b.operator){if(b.operator==d.operator){b.motion="expandToLine",b.motionArgs={linewise:!0},this.evalInput(c,a);return}az(c)}b.operator=d.operator,b.operatorArgs=aL(d.operatorArgs),a.visualMode&&this.evalInput(c,a)},processOperatorMotion:function(d,b,f){var c=b.visualMode,a=aL(f.operatorMotionArgs);a&&c&&a.visualLine&&(b.visualLine=!0),this.processOperator(d,b,f),c||this.processMotion(d,b,f)},processAction:function(f,b,h){var d=b.inputState,a=d.getRepeat(),c=!!a,g=aL(h.actionArgs)||{};d.selectedCharacter&&(g.selectedCharacter=d.selectedCharacter),h.operator&&this.processOperator(f,b,h),h.motion&&this.processMotion(f,b,h),(h.motion||h.operator)&&this.evalInput(f,b),g.repeat=a||1,g.repeatIsExplicit=c,g.registerName=d.registerName,az(f),b.lastMotion=null,h.isEdit&&this.recordLastEdit(b,d,h),aq[h.action](f,g,b)},processSearch:function(z,E,j){function B(e,a,c){cb.searchHistoryController.pushInput(e),cb.searchHistoryController.reset();try{cS(z,e,a,c)}catch(f){cK(z,"Invalid regex: "+e);return}bm.processMotion(z,E,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:j.searchArgs.toJumplist}})}function y(a){z.scrollTo(D.left,D.top),B(a,!0,!0);var c=cb.macroModeState;c.isRecording&&ci(c,a)}function q(f,m,e){var h=bQ.keyName(f),l;h=="Up"||h=="Down"?(l=h=="Up"?!0:!1,m=cb.searchHistoryController.nextMatch(m,l)||"",e(m)):h!="Left"&&h!="Right"&&h!="Ctrl"&&h!="Alt"&&h!="Shift"&&cb.searchHistoryController.reset();var c;try{c=cS(z,m,!0,!0)}catch(f){}c?z.scrollIntoView(aE(z,!b,c),30):(af(z),z.scrollTo(D.left,D.top))}function A(c,f,e){var a=bQ.keyName(c);if(a=="Esc"||a=="Ctrl-C"||a=="Ctrl-["){cb.searchHistoryController.pushInput(f),cb.searchHistoryController.reset(),cS(z,g),af(z),z.scrollTo(D.left,D.top),bQ.e_stop(c),e(),z.focus()}}if(!z.getSearchCursor){return}var b=j.searchArgs.forward,w=j.searchArgs.wholeWordOnly;cO(z).setReversed(!b);var F=b?"/":"?",g=cO(z).getQuery(),D=z.getScrollInfo();switch(j.searchArgs.querySrc){case"prompt":var x=cb.macroModeState;if(x.isPlaying){var d=x.replaySearchQueries.shift();B(d,!0,!1)}else{am(z,{onClose:y,prefix:F,desc:aj,onKeyUp:q,onKeyDown:A})}break;case"wordUnderCursor":var C=bA(z,!1,!0,!1,!0),k=!0;C||(C=bA(z,!1,!0,!1,!1),k=!1);if(!C){return}var d=z.getLine(C.start.line).substring(C.start.ch,C.end.ch);k&&w?d="\\b"+d+"\\b":d=av(d),cb.jumpList.cachedCursor=z.getCursor(),z.setCursor(C.start),B(d,!0,!1)}},processEx:function(d,b,f){function c(e){cb.exCommandHistoryController.pushInput(e),cb.exCommandHistoryController.reset(),ax.processCommand(d,e)}function a(g,k,j){var e=bQ.keyName(g),h;if(e=="Esc"||e=="Ctrl-C"||e=="Ctrl-["){cb.exCommandHistoryController.pushInput(k),cb.exCommandHistoryController.reset(),bQ.e_stop(g),j(),d.focus()}e=="Up"||e=="Down"?(h=e=="Up"?!0:!1,k=cb.exCommandHistoryController.nextMatch(k,h)||"",j(k)):e!="Left"&&e!="Right"&&e!="Ctrl"&&e!="Alt"&&e!="Shift"&&cb.exCommandHistoryController.reset()}f.type=="keyToEx"?ax.processCommand(d,f.exArgs.input):b.visualMode?am(d,{onClose:c,prefix:":",value:"'<,'>",onKeyDown:a}):am(d,{onClose:c,prefix:":",onKeyDown:a})},evalInput:function(cT,P){var Y=P.inputState,U=Y.motion,bn=Y.motionArgs||{},Q=Y.operator,X=Y.operatorArgs||{},J=Y.registerName,cW=P.sel,ct=cG(P.visualMode?cW.head:cT.getCursor("head")),an=cG(P.visualMode?cW.anchor:cT.getCursor("anchor")),cV=cG(ct),bt=cG(an),W,cU,I;Q&&this.recordLastEdit(P,Y),Y.repeatOverride!==undefined?I=Y.repeatOverride:I=Y.getRepeat();if(I>0&&bn.explicitRepeat){bn.repeatIsExplicit=!0}else{if(bn.noRepeat||!bn.explicitRepeat&&I===0){I=1,bn.repeatIsExplicit=!1}}Y.selectedCharacter&&(bn.selectedCharacter=X.selectedCharacter=Y.selectedCharacter),bn.repeat=I,az(cT);if(U){var Z=aD[U](cT,ct,bn,P);P.lastMotion=aD[U];if(!Z){return}if(bn.toJumplist){var cn=cb.jumpList,F=cn.cachedCursor;F?(bf(cT,F,Z),delete cn.cachedCursor):bf(cT,ct,Z)}Z instanceof Array?(cU=Z[0],W=Z[1]):W=Z,W||(W=cG(ct)),P.visualMode?(W=cD(cT,W,!0),cU&&(cU=cD(cT,cU,!0)),cU=cU||bt,cW.anchor=cU,cW.head=W,ag(cT),aR(cT,P,"<",aC(cU,W)?cU:W),aR(cT,P,">",aC(cU,W)?W:cU)):Q||(W=cD(cT,W),cT.setCursor(W.line,W.ch))}if(Q){if(X.lastSel){cU=bt;var H=X.lastSel,K=Math.abs(H.head.line-H.anchor.line),j=Math.abs(H.head.ch-H.anchor.ch);H.visualLine?W=bS(bt.line+K,bt.ch):H.visualBlock?W=bS(bt.line+K,bt.ch+j):H.head.line==H.anchor.line?W=bS(bt.line,bt.ch+j):W=bS(bt.line+K,bt.ch),P.visualMode=!0,P.visualLine=H.visualLine,P.visualBlock=H.visualBlock,cW=P.sel={anchor:cU,head:W},ag(cT)}else{P.visualMode&&(X.lastSel={anchor:cG(cW.anchor),head:cG(cW.head),visualBlock:P.visualBlock,visualLine:P.visualLine})}var G,b,z,R,at;if(P.visualMode){G=ad(cW.head,cW.anchor),b=a7(cW.head,cW.anchor),z=P.visualLine||X.linewise,R=P.visualBlock?"block":z?"line":"char",at=cq(cT,{anchor:G,head:b},R);if(z){var D=at.ranges;if(R=="block"){for(var V=0;V<D.length;V++){D[V].head.ch=aG(cT,D[V].head.line)}}else{R=="line"&&(D[0].head=bS(D[0].head.line+1,0))}}}else{G=cG(cU||bt),b=cG(W||cV);if(aC(b,G)){var q=G;G=b,b=q}z=bn.linewise||X.linewise,z?bP(cT,G,b):bn.forward&&bb(cT,G,b),R="char";var B=!bn.inclusive||z;at=cq(cT,{anchor:G,head:b},R,B)}cT.setSelections(at.ranges,at.primary),P.lastMotion=null,X.repeat=I,X.registerName=J,X.linewise=z;var cX=bd[Q](cT,X,at.ranges,bt,W);P.visualMode&&bj(cT),cX&&cT.setCursor(cX)}},recordLastEdit:function(c,a,d){var b=cb.macroModeState;if(b.isPlaying){return}c.lastEditInputState=a,c.lastEditActionCommand=d,b.lastInsertModeChanges.changes=[],b.lastInsertModeChanges.expectCursorActivityForChange=!1}},aD={moveToTopLine:function(c,a,d){var b=aW(c).top+d.repeat-1;return bS(b,b6(c.getLine(b)))},moveToMiddleLine:function(b){var a=aW(b),c=Math.floor((a.top+a.bottom)*0.5);return bS(c,b6(b.getLine(c)))},moveToBottomLine:function(c,a,d){var b=aW(c).bottom-d.repeat+1;return bS(b,b6(c.getLine(b)))},expandToLine:function(c,a,d){var b=a;return bS(b.line+d.repeat-1,Infinity)},findNext:function(f,b,g){var d=cO(f),a=d.getQuery();if(!a){return}var c=!g.forward;return c=d.isReversed()?!c:c,aQ(f,a),aE(f,c,a,g.repeat)},goToMark:function(f,b,g,d){var a=d.marks[g.selectedCharacter];if(a){var c=a.find();return g.linewise?{line:c.line,ch:b6(f.getLine(c.line))}:c}return null},moveToOtherHighlightedEnd:function(d,b,f,c){if(c.visualBlock&&f.sameLine){var a=c.sel;return[cD(d,bS(a.anchor.line,a.head.ch)),cD(d,bS(a.head.line,a.anchor.ch))]}return[c.sel.head,c.sel.anchor]},jumpToMark:function(m,w,g,b){var j=w;for(var x=0;x<g.repeat;x++){var d=j;for(var v in b.marks){if(!b2(v)){continue}var q=b.marks[v].find(),k=g.forward?aC(q,d):aC(d,q);if(k){continue}if(g.linewise&&q.line==d.line){continue}var h=aO(d,j),p=g.forward?aU(d,q,j):aU(j,q,d);if(h||p){j=q}}}return g.linewise&&(j=bS(j.line,b6(m.getLine(j.line)))),j},moveByCharacters:function(f,b,g){var d=b,a=g.repeat,c=g.forward?d.ch+a:d.ch-a;return bS(d.line,c)},moveByLines:function(j,m,d,b){var g=m,p=g.ch;switch(b.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:p=b.lastHPos;break;default:b.lastHPos=p}var c=d.repeat+(d.repeatOffset||0),l=d.forward?g.line+c:g.line-c,k=j.firstLine(),h=j.lastLine();if(l<k&&g.line==k||l>h&&g.line==h){return}return d.toFirstChar&&(p=b6(j.getLine(l)),b.lastHPos=p),b.lastHSPos=j.charCoords(bS(l,p),"div").left,bS(l,p)},moveByDisplayLines:function(j,m,d,b){var g=m;switch(b.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:b.lastHSPos=j.charCoords(g,"div").left}var p=d.repeat,c=j.findPosV(g,d.forward?p:-p,"line",b.lastHSPos);if(c.hitSide){if(d.forward){var l=j.charCoords(c,"div"),k={top:l.top+8,left:b.lastHSPos},c=j.coordsChar(k,"div")}else{var h=j.charCoords(bS(j.firstLine(),0),"div");h.left=b.lastHSPos,c=j.coordsChar(h,"div")}}return b.lastHPos=c.ch,c},moveByPage:function(d,b,f){var c=b,a=f.repeat;return d.findPosV(c,f.forward?a:-a,"page")},moveByParagraph:function(f,b,h){var d=b.line,a=h.repeat,c=h.forward?1:-1;for(var g=0;g<a;g++){if(!h.forward&&d===f.firstLine()||h.forward&&d==f.lastLine()){break}d+=c;while(d!==f.firstLine()&&d!=f.lastLine()&&f.getLine(d)){d+=c}}return bS(d,0)},moveByScroll:function(g,k,d,b){var f=g.getScrollInfo(),l=null,c=d.repeat;c||(c=f.clientHeight/(2*g.defaultTextHeight()));var j=g.charCoords(k,"local");d.repeat=c;var l=aD.moveByDisplayLines(g,k,d,b);if(!l){return null}var h=g.charCoords(l,"local");return g.scrollTo(null,f.top+h.top-j.top),l},moveByWords:function(b,a,c){return aJ(b,a,c.repeat,!!c.forward,!!c.wordEnd,!!c.bigWord)},moveTillCharacter:function(f,b,g){var d=g.repeat,a=cl(f,d,g.forward,g.selectedCharacter),c=g.forward?-1:1;return ap(c,g),a?(a.ch+=c,a):null},moveToCharacter:function(c,a,d){var b=d.repeat;return ap(0,d),cl(c,b,d.forward,d.selectedCharacter)||a},moveToSymbol:function(c,a,d){var b=d.repeat;return aS(c,b,d.forward,d.selectedCharacter)||a},moveToColumn:function(d,b,f,c){var a=f.repeat;return c.lastHPos=a-1,c.lastHSPos=d.charCoords(b,"div").left,a1(d,a)},moveToEol:function(f,b,h,d){var a=b;d.lastHPos=Infinity;var c=bS(a.line+h.repeat-1,Infinity),g=f.clipPos(c);return g.ch--,d.lastHSPos=f.charCoords(g,"div").left,c},moveToFirstNonWhiteSpaceCharacter:function(b,a){var c=a;return bS(c.line,b6(b.getLine(c.line)))},moveToMatchedSymbol:function(g,k){var d=k,b=d.line,f=d.ch,l=g.getLine(b),c;do{c=l.charAt(f++);if(c&&bl(c)){var j=g.getTokenTypeAt(bS(b,f));if(j!=="string"&&j!=="comment"){break}}}while(c);if(c){var h=g.findMatchingBracket(bS(b,f));return h.to}return d},moveToStartOfLine:function(b,a){return bS(a.line,0)},moveToLineOrEdgeOfDocument:function(c,a,d){var b=d.forward?c.lastLine():c.firstLine();return d.repeatIsExplicit&&(b=d.repeat-c.getOption("firstLineNumber")),bS(b,b6(c.getLine(b)))},textObjectManipulation:function(g,c,j){var f={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["},b={"'":!0,'"':!0},d=j.selectedCharacter;d=="b"?d="(":d=="B"&&(d="{");var h=!j.textObjectInner,a;if(f[d]){a=aB(g,c,d,h)}else{if(b[d]){a=cB(g,c,d,h)}else{if(d==="W"){a=bA(g,h,!0,!0)}else{if(d==="w"){a=bA(g,h,!0,!1)}else{if(d!=="p"){return null}a=expandParagraphUnderCursor(g,h,!0,!1)}}}}return g.state.vim.visualMode?a8(g,a.start,a.end):[a.start,a.end]},repeatLastCharacterSearch:function(g,c,j){var f=cb.lastChararacterSearch,b=j.repeat,d=j.forward===f.forward,h=(f.increment?1:0)*(d?-1:1);g.moveH(-h,"char"),j.inclusive=d?!0:!1;var a=cl(g,b,d,f.selectedCharacter);return a?(a.ch+=h,a):(g.moveH(h,"char"),c)}},bd={change:function(k,q,d){var b,h,v=k.state.vim;cb.macroModeState.lastInsertModeChanges.inVisualBlock=v.visualBlock;if(!v.visualMode){var c=d[0].anchor,p=d[0].head;h=k.getRange(c,p);if(!b1(h)){var m=/\s+$/.exec(h);m&&(p=cH(p,0,-m[0].length),h=h.slice(0,-m[0].length))}var j=p.line-1==k.lastLine();k.replaceRange("",c,p),q.linewise&&!j&&(bQ.commands.newlineAndIndent(k),c.ch=null),b=c}else{h=k.getSelection();var g=bg("",d.length);k.replaceSelections(g),b=ad(d[0].head,d[0].anchor)}cb.registerController.pushText(q.registerName,"change",h,q.linewise,d.length>1),aq.enterInsertMode(k,{head:b},k.state.vim)},"delete":function(g,k,d){var b,f,l=g.state.vim;if(!l.visualBlock){var c=d[0].anchor,j=d[0].head;k.linewise&&j.line!=g.firstLine()&&c.line==g.lastLine()&&c.line==j.line-1&&(c.line==g.firstLine()?c.ch=0:c=bS(c.line-1,aG(g,c.line-1))),f=g.getRange(c,j),g.replaceRange("",c,j),b=c,k.linewise&&(b=aD.moveToFirstNonWhiteSpaceCharacter(g,c))}else{f=g.getSelection();var h=bg("",d.length);g.replaceSelections(h),b=d[0].anchor}return cb.registerController.pushText(k.registerName,"delete",f,k.linewise,l.visualBlock),b},indent:function(g,k,d){var b=g.state.vim,f=d[0].anchor.line,l=b.visualBlock?d[d.length-1].anchor.line:d[0].head.line,c=b.visualMode?k.repeat:1;k.linewise&&l--;for(var j=f;j<=l;j++){for(var h=0;h<c;h++){g.indentLine(j,k.indentRight)}}return aD.moveToFirstNonWhiteSpaceCharacter(g,d[0].anchor)},changeCase:function(q,y,g,b,k){var z=q.getSelections(),d=[],x=y.toLower;for(var w=0;w<z.length;w++){var p=z[w],j="";if(x===!0){j=p.toLowerCase()}else{if(x===!1){j=p.toUpperCase()}else{for(var v=0;v<p.length;v++){var m=p.charAt(v);j+=bZ(m)?m.toLowerCase():m.toUpperCase()}}}d.push(j)}return q.replaceSelections(d),y.shouldMoveCursor?k:!q.state.vim.visualMode&&y.linewise&&g[0].anchor.line+1==g[0].head.line?aD.moveToFirstNonWhiteSpaceCharacter(q,b):y.linewise?b:ad(g[0].anchor,g[0].head)},yank:function(f,b,h,d){var a=f.state.vim,c=f.getSelection(),g=a.visualMode?ad(a.sel.anchor,a.sel.head,h[0].head,h[0].anchor):d;return cb.registerController.pushText(b.registerName,"yank",c,b.linewise,a.visualBlock),g}},aq={jumpListWalk:function(g,c,j){if(j.visualMode){return}var f=c.repeat,b=c.forward,d=cb.jumpList,h=d.move(g,b?f:-f),a=h?h.find():undefined;a=a?a:g.getCursor(),g.setCursor(a)},scroll:function(k,q,d){if(d.visualMode){return}var b=q.repeat||1,h=k.defaultTextHeight(),v=k.getScrollInfo().top,c=h*b,p=q.forward?v+c:v-c,m=cG(k.getCursor()),j=k.charCoords(m,"local");if(q.forward){p>j.top?(m.line+=(p-j.top)/h,m.line=Math.ceil(m.line),k.setCursor(m),j=k.charCoords(m,"local"),k.scrollTo(null,j.top)):k.scrollTo(null,p)}else{var g=p+k.getScrollInfo().clientHeight;g<j.bottom?(m.line-=(j.bottom-g)/h,m.line=Math.floor(m.line),k.setCursor(m),j=k.charCoords(m,"local"),k.scrollTo(null,j.bottom-k.getScrollInfo().clientHeight)):k.scrollTo(null,p)}},scrollToCursor:function(f,b){var h=f.getCursor().line,d=f.charCoords(bS(h,0),"local"),a=f.getScrollInfo().clientHeight,c=d.top,g=d.bottom-c;switch(b.position){case"center":c=c-a/2+g;break;case"bottom":c=c-a+g*1.4;break;case"top":c+=g*0.4}f.scrollTo(null,c)},replayMacro:function(f,b,g){var d=b.selectedCharacter,a=b.repeat,c=cb.macroModeState;d=="@"&&(d=c.latestRegister);while(a--){aM(f,g,c,d)}},enterMacroRecordMode:function(c,a){var d=cb.macroModeState,b=a.selectedCharacter;d.enterMacroRecordMode(c,b)},enterInsertMode:function(f,b,h){if(f.getOption("readOnly")){return}h.insertMode=!0,h.insertModeRepeat=b&&b.repeat||1;var d=b?b.insertAt:null,a=h.sel,c=b.head||f.getCursor("head"),g=f.listSelections().length;if(d=="eol"){c=bS(c.line,aG(f,c.line))}else{if(d=="charAfter"){c=cH(c,0,1)}else{if(d=="firstNonBlank"){c=aD.moveToFirstNonWhiteSpaceCharacter(f,c)}else{if(d=="startOfSelectedArea"){h.visualBlock?(c=bS(Math.min(a.head.line,a.anchor.line),Math.min(a.head.ch,a.anchor.ch)),g=Math.abs(a.head.line-a.anchor.line)+1):a.head.line<a.anchor.line?c=a.head:c=bS(a.anchor.line,0)}else{if(d=="endOfSelectedArea"){h.visualBlock?(c=bS(Math.min(a.head.line,a.anchor.line),Math.max(a.head.ch+1,a.anchor.ch)),g=Math.abs(a.head.line-a.anchor.line)+1):a.head.line>=a.anchor.line?c=cH(a.head,0,1):c=bS(a.anchor.line,0)}else{if(d=="inplace"&&h.visualMode){return}}}}}}f.setOption("keyMap","vim-insert"),f.setOption("disableInput",!1),b&&b.replace?(f.toggleOverwrite(!0),f.setOption("keyMap","vim-replace"),bQ.signal(f,"vim-mode-change",{mode:"replace"})):(f.setOption("keyMap","vim-insert"),bQ.signal(f,"vim-mode-change",{mode:"insert"})),cb.macroModeState.isPlaying||(f.on("change",ba),bQ.on(f.getInputField(),"keydown",bc)),h.visualMode&&bj(f),aK(f,c,g)},toggleVisualMode:function(f,b,g){var d=b.repeat,a=f.getCursor(),c;g.visualMode?g.visualLine^b.linewise||g.visualBlock^b.blockwise?(g.visualLine=!!b.linewise,g.visualBlock=!!b.blockwise,bQ.signal(f,"vim-mode-change",{mode:"visual",subMode:g.visualLine?"linewise":g.visualBlock?"blockwise":""}),ag(f)):bj(f):(g.visualMode=!0,g.visualLine=!!b.linewise,g.visualBlock=!!b.blockwise,c=cD(f,bS(a.line,a.ch+d-1),!0),g.sel={anchor:a,head:c},bQ.signal(f,"vim-mode-change",{mode:"visual",subMode:g.visualLine?"linewise":g.visualBlock?"blockwise":""}),ag(f),aR(f,g,"<",ad(a,c)),aR(f,g,">",a7(a,c)))},reselectLastSelection:function(f,b,g){var d=g.lastSelection;g.visualMode&&b9(f,g);if(d){var a=d.anchorMark.find(),c=d.headMark.find();if(!a||!c){return}g.sel={anchor:a,head:c},g.visualMode=!0,g.visualLine=d.visualLine,g.visualBlock=d.visualBlock,ag(f),aR(f,g,"<",ad(a,c)),aR(f,g,">",a7(a,c)),bQ.signal(f,"vim-mode-change",{mode:"visual",subMode:g.visualLine?"linewise":g.visualBlock?"blockwise":""})}},joinLines:function(k,q,d){var b,h;if(d.visualMode){b=k.getCursor("anchor"),h=k.getCursor("head"),h.ch=aG(k,h.line)-1}else{var v=Math.max(q.repeat,2);b=k.getCursor(),h=cD(k,bS(b.line+v-1,Infinity))}var c=0;for(var p=b.line;p<h.line;p++){c=aG(k,b.line);var m=bS(b.line+1,aG(k,b.line+1)),j=k.getRange(b,m);j=j.replace(/\n\s*/g," "),k.replaceRange(j,b,m)}var g=bS(b.line,c);k.setCursor(g),d.visualMode&&bj(k)},newLineAndEnterInsertMode:function(d,b,f){f.insertMode=!0;var c=cG(d.getCursor());if(c.line===d.firstLine()&&!b.after){d.replaceRange("\n",bS(d.firstLine(),0)),d.setCursor(d.firstLine(),0)}else{c.line=b.after?c.line:c.line-1,c.ch=aG(d,c.line),d.setCursor(c);var a=bQ.commands.newlineAndIndentContinueComment||bQ.commands.newlineAndIndent;a(d)}this.enterInsertMode(d,{repeat:b.repeat},f)},paste:function(Y,H,O){var K=cG(Y.getCursor()),U=cb.registerController.getRegister(H.registerName),I=U.toString();if(!I){return}if(H.matchIndent){var M=Y.getOption("tabSize"),F=function(c){var a=c.split("	").length-1,d=c.split(" ").length-1;return a*M+d*1},at=Y.getLine(Y.getCursor().line),X=F(at.match(/^\s*/)[0]),Q=I.replace(/\n$/,""),an=I!==Q,V=F(I.match(/^\s*/)[0]),I=Q.replace(/^\s*/gm,function(a){var d=X+(F(a)-V);if(d<0){return""}if(Y.getOption("indentWithTabs")){var c=Math.floor(d/M);return Array(c+1).join("	")}return Array(d+1).join(" ")});I+=an?"\n":""}if(H.repeat>1){var I=Array(H.repeat+1).join(I)}var L=U.linewise,Z=U.blockwise;if(L){O.visualMode?I=O.visualLine?I.slice(0,-1):"\n"+I.slice(0,I.length-1)+"\n":H.after?(I="\n"+I.slice(0,I.length-1),K.ch=aG(Y,K.line)):K.ch=0}else{if(Z){I=I.split("\n");for(var D=0;D<I.length;D++){I[D]=I[D]==""?" ":I[D]}}K.ch+=H.after?1:0}var P,W;if(O.visualMode){O.lastPastedText=I;var z,B=ac(Y,O),G=B[0],j=B[1],A=Y.getSelection(),b=Y.listSelections(),q=(new Array(b.length)).join("1").split("1");O.lastSelection&&(z=O.lastSelection.headMark.find()),cb.registerController.unnamedRegister.setText(A),Z?(Y.replaceSelections(q),j=bS(G.line+I.length-1,G.ch),Y.setCursor(G),cC(Y,j),Y.replaceSelections(I),P=G):O.visualBlock?(Y.replaceSelections(q),Y.setCursor(G),Y.replaceRange(I,G,G),P=G):(Y.replaceRange(I,G,j),P=Y.posFromIndex(Y.indexFromPos(G)+I.length-1)),z&&(O.lastSelection.headMark=Y.setBookmark(z)),L&&(P.ch=0)}else{if(Z){Y.setCursor(K);for(var D=0;D<I.length;D++){var J=K.line+D;J>Y.lastLine()&&Y.replaceRange("\n",bS(J,0));var R=aG(Y,J);R<K.ch&&ay(Y,J,K.ch)}Y.setCursor(K),cC(Y,bS(K.line+I.length-1,K.ch)),Y.replaceSelections(I),P=K}else{Y.replaceRange(I,K),L&&H.after?P=bS(K.line+1,b6(Y.getLine(K.line+1))):L&&!H.after?P=bS(K.line,b6(Y.getLine(K.line))):!L&&H.after?(W=Y.indexFromPos(K),P=Y.posFromIndex(W+I.length-1)):(W=Y.indexFromPos(K),P=Y.posFromIndex(W+I.length))}}O.visualMode&&bj(Y),Y.setCursor(P)},undo:function(b,a){b.operation(function(){cQ(b,bQ.commands.undo,a.repeat)(),b.setCursor(b.getCursor("anchor"))})},redo:function(b,a){cQ(b,bQ.commands.redo,a.repeat)()},setRegister:function(b,a,c){c.inputState.registerName=a.selectedCharacter},setMark:function(c,a,d){var b=a.selectedCharacter;aR(c,d,b,c.getCursor())},replace:function(k,q,d){var b=q.selectedCharacter,h=k.getCursor(),v,c,p=k.listSelections();if(d.visualMode){h=k.getCursor("start"),c=k.getCursor("end")}else{var m=k.getLine(h.line);v=h.ch+q.repeat,v>m.length&&(v=m.length),c=bS(h.line,v)}if(b=="\n"){d.visualMode||k.replaceRange("",h,c),(bQ.commands.newlineAndIndentContinueComment||bQ.commands.newlineAndIndent)(k)}else{var j=k.getRange(h,c);j=j.replace(/[^\n]/g,b);if(d.visualBlock){var g=(new Array(k.getOption("tabSize")+1)).join(" ");j=k.getSelection(),j=j.replace(/\t/g,g).replace(/[^\n]/g,b).split("\n"),k.replaceSelections(j)}else{k.replaceRange(j,h,c)}d.visualMode?(h=aC(p[0].anchor,p[0].head)?p[0].anchor:p[0].head,k.setCursor(h),bj(k)):k.setCursor(cH(c,0,-1))}},incrementNumberToken:function(w,A){var j=w.getCursor(),b=w.getLine(j.line),m=/-?\d+/g,B,g,z,y,v;while((B=m.exec(b))!==null){v=B[0],g=B.index,z=g+v.length;if(j.ch<z){break}}if(!A.backtrack&&z<=j.ch){return}if(!v){return}var k=A.increase?1:-1,x=parseInt(v)+k*A.repeat,q=bS(j.line,g),d=bS(j.line,z);y=x.toString(),w.replaceRange(y,q,d),w.setCursor(bS(j.line,g+y.length-1))},repeatLastEdit:function(d,b,f){var c=f.lastEditInputState;if(!c){return}var a=b.repeat;a&&b.repeatIsExplicit?f.lastEditInputState.repeatOverride=a:a=f.lastEditInputState.repeatOverride||a,bV(d,f,a,!1)},exitInsertMode:cE},cL={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},a2={bracket:{isComplete:function(a){if(a.nextCh===a.symb){a.depth++;if(a.depth>=1){return !0}}else{a.nextCh===a.reverseSymb&&a.depth--}return !1}},section:{init:function(a){a.curMoveThrough=!0,a.symb=(a.forward?"]":"[")===a.symb?"{":"}"},isComplete:function(a){return a.index===0&&a.nextCh===a.symb}},comment:{isComplete:function(b){var a=b.lastCh==="*"&&b.nextCh==="/";return b.lastCh=b.nextCh,a}},method:{init:function(a){a.symb=a.symb==="m"?"{":"}",a.reverseSymb=a.symb==="{"?"}":"{"},isComplete:function(a){return a.nextCh===a.symb?!0:!1}},preprocess:{init:function(a){a.index=0},isComplete:function(b){if(b.nextCh==="#"){var a=b.lineText.match(/#(\w+)/)[1];if(a==="endif"){if(b.forward&&b.depth===0){return !0}b.depth++}else{if(a==="if"){if(!b.forward&&b.depth===0){return !0}b.depth--}}if(a==="else"&&b.depth===0){return !0}}return !1}}};ch("pcre",!0,"boolean"),aX.prototype={getQuery:function(){return cb.query},setQuery:function(a){cb.query=a},getOverlay:function(){return this.searchOverlay},setOverlay:function(a){this.searchOverlay=a},isReversed:function(){return cb.isReversed},setReversed:function(a){cb.isReversed=a}};var aj="(Javascript regexp)",aI=[{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"set"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"global",shortName:"g"}],a0=function(){this.buildCommandMap_()};a0.prototype={processCommand:function(m,w,g){var b=m.state.vim,j=cb.registerController.getRegister(":"),x=j.toString();b.visualMode&&bj(m);var d=new bQ.StringStream(w);j.setText(w);var v=g||{};v.input=w;try{this.parseInput_(m,d,v)}catch(q){throw cK(m,q),q}var k,h;if(!v.commandName){v.line!==undefined&&(h="move")}else{k=this.matchCommand_(v.commandName);if(k){h=k.name,k.excludeFromCommandHistory&&j.setText(x),this.parseCommandArgs_(d,v,k);if(k.type=="exToKey"){for(var p=0;p<k.toKeys.length;p++){bQ.Vim.handleKey(m,k.toKeys[p],"mapping")}return}if(k.type=="exToEx"){this.processCommand(m,k.toInput);return}}}if(!h){cK(m,'Not an editor command ":'+w+'"');return}try{ab[h](m,v),(!k||!k.possiblyAsync)&&v.callback&&v.callback()}catch(q){throw cK(m,q),q}},parseInput_:function(c,a,d){a.eatWhile(":"),a.eat("%")?(d.line=c.firstLine(),d.lineEnd=c.lastLine()):(d.line=this.parseLineSpec_(c,a),d.line!==undefined&&a.eat(",")&&(d.lineEnd=this.parseLineSpec_(c,a)));var b=a.match(/^(\w+)/);return b?d.commandName=b[1]:d.commandName=a.match(/.*/)[0],d},parseLineSpec_:function(c,a){var d=a.match(/^(\d+)/);if(d){return parseInt(d[1],10)-1}switch(a.next()){case".":return c.getCursor().line;case"$":return c.lastLine();case"'":var b=c.state.vim.marks[a.next()];if(b&&b.find()){return b.find().line}throw new Error("Mark not set");default:return a.backUp(1),undefined}},parseCommandArgs_:function(d,b,f){if(d.eol()){return}b.argString=d.match(/.*/)[0];var c=f.argDelimiter||/\s+/,a=aa(b.argString).split(c);a.length&&a[0]&&(b.args=a)},matchCommand_:function(c){for(var a=c.length;a>0;a--){var d=c.substring(0,a);if(this.commandMap_[d]){var b=this.commandMap_[d];if(b.name.indexOf(c)===0){return b}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var b=0;b<aI.length;b++){var a=aI[b],c=a.shortName||a.name;this.commandMap_[c]=a}},map:function(d,b,f){if(d!=":"&&d.charAt(0)==":"){if(f){throw Error("Mode not supported for ex mappings")}var c=d.substring(1);b!=":"&&b.charAt(0)==":"?this.commandMap_[c]={name:c,type:"exToEx",toInput:b.substring(1),user:!0}:this.commandMap_[c]={name:c,type:"exToKey",toKeys:b,user:!0}}else{if(b!=":"&&b.charAt(0)==":"){var a={keys:d,type:"keyToEx",exArgs:{input:b.substring(1)},user:!0};f&&(a.context=f),bo.unshift(a)}else{var a={keys:d,type:"keyToKey",toKeys:b,user:!0};f&&(a.context=f),bo.unshift(a)}}},unmap:function(d,b){if(d!=":"&&d.charAt(0)==":"){if(b){throw Error("Mode not supported for ex mappings")}var f=d.substring(1);if(this.commandMap_[f]&&this.commandMap_[f].user){delete this.commandMap_[f];return}}else{var c=d;for(var a=0;a<bo.length;a++){if(c==bo[a].keys&&bo[a].context===b&&bo[a].user){bo.splice(a,1);return}}}throw Error("No such mapping.")}};var ab={map:function(c,a,d){var b=a.args;if(!b||b.length<2){c&&cK(c,"Invalid mapping: "+a.input);return}ax.map(b[0],b[1],d)},imap:function(b,a){this.map(b,a,"insert")},nmap:function(b,a){this.map(b,a,"normal")},vmap:function(b,a){this.map(b,a,"visual")},unmap:function(c,a,d){var b=a.args;if(!b||b.length<1){c&&cK(c,"No such mapping: "+a.input);return}ax.unmap(b[0],d)},move:function(b,a){bm.processCommand(b,b.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:a.line+1})},set:function(g,k){var d=k.args;if(!d||d.length<1){g&&cK(g,"Invalid mapping: "+k.input);return}var b=d[0].split("="),f=b[0],l=b[1],c=!1;if(f.charAt(f.length-1)=="?"){if(l){throw Error("Trailing characters: "+k.argString)}f=f.substring(0,f.length-1),c=!0}l===undefined&&f.substring(0,2)=="no"&&(f=f.substring(2),l=!1);var j=cj[f]&&cj[f].type=="boolean";j&&l==undefined&&(l=!0);if(!j&&!l||c){var h=co(f);h===!0||h===!1?cK(g," "+(h?"":"no")+f):cK(g,"  "+f+"="+h)}else{b8(f,l,g)}},registers:function(g,k){var d=k.args,b=cb.registerController.registers,f="----------Registers----------<br><br>";if(!d){for(var l in b){var c=b[l].toString();c.length&&(f+='"'+l+"    "+c+"<br>")}}else{var l;d=d.join("");for(var j=0;j<d.length;j++){l=d.charAt(j);if(!cb.registerController.isValidRegister(l)){continue}var h=b[l]||new cA;f+='"'+l+"    "+h.toString()+"<br>"}}cK(g,f)},sort:function(M,z){function D(){if(z.argString){var i=new bQ.StringStream(z.argString);i.eat("!")&&(F=!0);if(i.eol()){return}if(!i.eatSpace()){return"Invalid arguments"}var l=i.match(/[a-z]+/);if(l){l=l[0],B=l.indexOf("i")!=-1,I=l.indexOf("u")!=-1;var g=l.indexOf("d")!=-1&&1,c=l.indexOf("x")!=-1&&1,h=l.indexOf("o")!=-1&&1;if(g+c+h>1){return"Invalid arguments"}A=g&&"decimal"||c&&"hex"||h&&"octal"}i.eatSpace()&&i.match(/\/.*\//)&&"patterns not supported"}}function j(g,f){if(F){var c;c=g,g=f,f=c}B&&(g=g.toLowerCase(),f=f.toLowerCase());var h=A&&C.exec(g),a=A&&C.exec(f);return h?(h=parseInt((h[1]+h[2]).toLowerCase(),k),a=parseInt((a[1]+a[2]).toLowerCase(),k),h-a):g<f?-1:1}var F,B,I,A,q=D();if(q){cK(M,q+": "+z.argString);return}var O=z.line||M.firstLine(),L=z.lineEnd||z.line||M.lastLine();if(O==L){return}var H=bS(O,0),N=bS(L,aG(M,L)),J=M.getRange(H,N).split("\n"),C=A=="decimal"?/(-?)([\d]+)/:A=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:A=="octal"?/([0-7]+)/:null,k=A=="decimal"?10:A=="hex"?16:A=="octal"?8:null,G=[],K=[];if(A){for(var d=0;d<J.length;d++){C.exec(J[d])?G.push(J[d]):K.push(J[d])}}else{K=J}G.sort(j),K.sort(j),J=F?G.concat(K):K.concat(G);if(I){var x=J,b;J=[];for(var d=0;d<x.length;d++){x[d]!=b&&J.push(x[d]),b=x[d]}}M.replaceRange(J.join("\n"),H,N)},global:function(y,E){var k=E.argString;if(!k){cK(y,"Regular Expression missing from global");return}var b=E.line!==undefined?E.line:y.firstLine(),q=E.lineEnd||E.line||y.lastLine(),F=aF(k),j=k,D;F.length&&(j=F[0],D=F.slice(1,F.length).join("/"));if(j){try{cS(y,j,!0,!0)}catch(B){cK(y,"Invalid regex: "+j);return}}var x=cO(y).getQuery(),m=[],A="";for(var w=b;w<=q;w++){var g=x.test(y.getLine(w));g&&(m.push(w+1),A+=y.getLine(w)+"<br>")}if(!D){cK(y,A);return}var z=0,C=function(){if(z<m.length){var a=m[z]+D;ax.processCommand(y,a,{callback:C})}z++};C()},substitute:function(G,k){if(!G.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.")}var z=k.argString,w=z?aF(z):[],C,q="",y,j,J,F=!1,B=!1;if(w.length){C=w[0],q=w[1],q!==undefined&&(co("pcre")?q=cF(q):q=au(q),cb.lastSubstituteReplacePart=q),y=w[2]?w[2].split(" "):[]}else{if(z&&z.length){cK(G,"Substitutions should be of the form :s/pattern/replace/");return}}y&&(j=y[0],J=parseInt(y[1]),j&&(j.indexOf("c")!=-1&&(F=!0,j.replace("c","")),j.indexOf("g")!=-1&&(B=!0,j.replace("g","")),C=C+"/"+j));if(C){try{cS(G,C,!0,!0)}catch(I){cK(G,"Invalid regex: "+C);return}}q=q||cb.lastSubstituteReplacePart;if(q===undefined){cK(G,"No previous substitute regular expression");return}var D=cO(G),x=D.getQuery(),H=k.line!==undefined?k.line:G.getCursor().line,b=k.lineEnd||H;J&&(H=b,b=H+J-1);var A=cD(G,bS(H,0)),E=G.getSearchCursor(x,A);aA(G,F,B,H,b,E,x,q,k.callback)},redo:bQ.commands.redo,undo:bQ.commands.undo,write:function(a){bQ.commands.save?bQ.commands.save(a):a.save()},nohlsearch:function(a){af(a)},delmarks:function(m,w){if(!w.argString||!aa(w.argString)){cK(m,"Argument required");return}var g=m.state.vim,b=new bQ.StringStream(aa(w.argString));while(!b.eol()){b.eatSpace();var j=b.pos;if(!b.match(/[a-zA-Z]/,!1)){cK(m,"Invalid argument: "+w.argString.substring(j));return}var x=b.next();if(b.match("-",!0)){if(!b.match(/[a-zA-Z]/,!1)){cK(m,"Invalid argument: "+w.argString.substring(j));return}var d=x,v=b.next();if(!(b2(d)&&b2(v)||bZ(d)&&bZ(v))){cK(m,"Invalid argument: "+d+"-");return}var q=d.charCodeAt(0),k=v.charCodeAt(0);if(q>=k){cK(m,"Invalid argument: "+w.argString.substring(j));return}for(var h=0;h<=k-q;h++){var p=String.fromCharCode(q+h);delete g.marks[p]}}else{delete g.marks[x]}}}},ax=new a0;bQ.keyMap.vim={attach:cc,detach:cx},ch("insertModeEscKeysTimeout",200,"number"),bQ.keyMap["vim-insert"]={"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(b){var a=bQ.commands.newlineAndIndentContinueComment||bQ.commands.newlineAndIndent;a(b)},fallthrough:["default"],attach:cc,detach:cx},bQ.keyMap["await-second"]={fallthrough:["vim-insert"],attach:cc,detach:cx},bQ.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:cc,detach:cx},aZ(),bQ.Vim=bp(),bp=bQ.Vim,cr={"return":"CR",backspace:"BS","delete":"Del",esc:"Esc",left:"Left",right:"Right",up:"Up",down:"Down",space:"Space",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",enter:"CR"};var bH=bp.handleKey;bp.handleKey=function(b,a,c){return b.operation(function(){return bH(b,a,c)},!0)},bu.CodeMirror=bQ;var cN=bp.maybeInitVimState_;bu.handler={$id:"ace/keyboard/vim",drawCursor:function(j,q,g,b,v){var d=this.state.vim||{},p=g.characterWidth,m=g.lineHeight,i=q.top,h=q.left;if(!d.insertMode){var k=b.cursor?bJ.comparePoints(b.cursor,b.start)<=0:v.selection.isBackwards()||v.selection.isEmpty();!k&&h>p&&(h-=p)}!d.insertMode&&d.status&&(m/=2,i+=m),j.left=h+"px",j.top=i+"px",j.width=p+"px",j.height=m+"px"},handleKeyboard:function(k,q,d,b,h){var v=k.editor,c=v.state.cm,p=cN(c);if(b==-1){return}if(d=="c"&&q==1){return !bR.isMac&&v.getCopyText()?(v.once("copy",function(){v.selection.clearSelection()}),{command:"null",passEvent:!0}):{command:coreCommands.stop}}p.insertMode||bR.isMac&&this.handleMacRepeat(k,q,d)&&(q=-1,d=k.inputChar);if(q==-1||q&1||q===0&&d.length>1){var m=p.insertMode,j=b3(q,d,h||{});p.status==null&&(p.status="");var g=ar(c,j,"user");p=cN(c),g&&p.status!=null?p.status+=j:p.status==null&&(p.status=""),c._signal("changeStatus");if(!g&&(q!=-1||m)){return}return{command:"null",passEvent:!g}}},attach:function(b){b.state||(b.state={});var a=new bQ(b);b.state.cm=a,b.$vimModeHandler=this,bQ.keyMap.vim.attach(a),cN(a).status=null,a.on("vim-command-done",function(){if(a.virtualSelectionMode()){return}cN(a).status=null,a.ace._signal("changeStatus"),a.ace.session.markUndoGroup()}),a.on("changeStatus",function(){a.ace.renderer.updateCursor(),a.ace._signal("changeStatus")}),a.on("vim-mode-change",function(){if(a.virtualSelectionMode()){return}a.ace.renderer.setStyle("normal-mode",!cN(a).insertMode),a._signal("changeStatus")}),a.ace.renderer.setStyle("normal-mode",!cN(a).insertMode),b.renderer.$cursorLayer.drawCursor=this.drawCursor.bind(a),this.updateMacCompositionHandlers(b,!0)},detach:function(b){var a=b.state.cm;bQ.keyMap.vim.detach(a),a.destroy(),b.state.cm=null,b.$vimModeHandler=null,b.renderer.$cursorLayer.drawCursor=null,b.renderer.setStyle("normal-mode",!1),this.updateMacCompositionHandlers(b,!1)},getStatusText:function(c){var a=c.state.cm,d=cN(a);if(d.insertMode){return"INSERT"}var b="";return d.visualMode&&(b+="VISUAL",d.visualLine&&(b+=" LINE"),d.visualBlock&&(b+=" BLOCK")),d.status&&(b+=(b?" ":"")+d.status),b},handleMacRepeat:function(b,a,c){if(a==-1){b.inputChar=c,b.lastEvent="input"}else{if(b.inputChar&&b.$lastHash==a&&b.$lastKey==c){if(b.lastEvent=="input"){b.lastEvent="input1"}else{if(b.lastEvent=="input1"){return !0}}}else{b.$lastHash=a,b.$lastKey=c,b.lastEvent="keypress"}}},updateMacCompositionHandlers:function(c,a){var d=function(f){var h=c.state.cm,g=cN(h);if(!g.insertMode){var e=this.textInput.getElement();e.blur(),e.focus(),e.value=f}else{this.onCompositionUpdateOrig(f)}},b=function(e){var g=c.state.cm,f=cN(g);f.insertMode||this.onCompositionStartOrig(e)};a?c.onCompositionUpdateOrig||(c.onCompositionUpdateOrig=c.onCompositionUpdate,c.onCompositionUpdate=d,c.onCompositionStartOrig=c.onCompositionStart,c.onCompositionStart=b):c.onCompositionUpdateOrig&&(c.onCompositionUpdate=c.onCompositionUpdateOrig,c.onCompositionUpdateOrig=null,c.onCompositionStart=c.onCompositionStartOrig,c.onCompositionStartOrig=null)}};var a3={getText:function(b,a){return(Math.abs(b.selection.lead.row-a)||a+1+(a<9?"\u00b7":""))+""},getWidth:function(b,a,c){return b.getLength().toString().length*c.characterWidth},update:function(b,a){a.renderer.$loop.schedule(a.renderer.CHANGE_GUTTER)},attach:function(a){a.renderer.$gutterLayer.$renderer=this,a.on("changeSelection",this.update)},detach:function(a){a.renderer.$gutterLayer.$renderer=null,a.off("changeSelection",this.update)}};bp.defineOption({name:"wrap",set:function(b,a){a&&a.ace.setOption("wrap",b)},type:"boolean"},!1),bo.push({keys:"zc",type:"action",action:"fold",actionArgs:{open:!1}},{keys:"zC",type:"action",action:"fold",actionArgs:{open:!1,all:!0}},{keys:"zo",type:"action",action:"fold",actionArgs:{open:!0}},{keys:"zO",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"za",type:"action",action:"fold",actionArgs:{toggle:!0}},{keys:"zA",type:"action",action:"fold",actionArgs:{toggle:!0,all:!0}},{keys:"zf",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"zd",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"<C-A-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAbove"}},{keys:"<C-A-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelow"}},{keys:"<C-A-S-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAboveSkipCurrent"}},{keys:"<C-A-S-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelowSkipCurrent"}},{keys:"<C-A-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreBefore"}},{keys:"<C-A-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreAfter"}},{keys:"<C-A-S-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextBefore"}},{keys:"<C-A-S-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextAfter"}}),aq.aceCommand=function(b,a,c){b.vimCmd=a,b.ace.inVirtualSelectionMode?b.ace.on("beforeEndOperation",aT):aT(null,b.ace)},aq.fold=function(b,a,c){b.ace.execCommand(["toggleFoldWidget","toggleFoldWidget","foldOther","unfoldall"][(a.all?2:0)+(a.open?1:0)])},bu.handler.defaultKeymap=bo,bp.map("Y","yy")});