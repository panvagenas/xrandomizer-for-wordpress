/*
 * Random sets pages script
 *
 * Copyright: Â© 2014
 * {@link http://xdark.eu}
 *
 * @author Panagiotis Vagenas <pan.vagenas@gmail.com>
 * @package XRandomizer
 * @since 140914
 */
(function(c){function b(f,e,d,g){this.elementSet=e.toString();this.elementSetId=d.toString();this.mode=g==undefined?"html":g.toString();this.oldElement={};this.oldElement.elementIndex=parseInt(f);this.oldElement.$wrapper=c("#element-row-"+e+"-"+this.oldElement.elementIndex.toString());this.oldElement.$wrapper.textAreaWrapper=this.oldElement.$wrapper.children(".text-area-wrapper");this.oldElement.$wrapper.textArea=this.oldElement.$wrapper.textAreaWrapper.children(".text-area");this.oldElement.$wrapper.elementControls=this.oldElement.$wrapper.children(".element-control");this.newElement={elementIndex:parseInt(f)+1,$wrapper:null}}b.prototype.addNewElementAfterOld=function(){this.formNewElement("");this.updateNextElements();this.addAfterOld();this.bindClickEvent();a.prototype.bindEditor(c(this.newElement.$wrapper.textArea))};b.prototype.formNewElement=function(d){this.newElement.$wrapper=c(this.oldElement.$wrapper[0].outerHTML);this.newElement.$wrapper.find(".ace_editor").remove();this.newElement.$wrapper.textAreaWrapper=this.newElement.$wrapper.children(".text-area-wrapper");this.newElement.$wrapper.textArea=this.newElement.$wrapper.textAreaWrapper.children(".text-area");this.newElement.$wrapper.elementControls=this.newElement.$wrapper.children(".element-control");this.newElement.$wrapper.attr("data-index",this.newElement.elementIndex);this.newElement.$wrapper.attr("id","element-row-"+this.elementSet+"-"+this.newElement.elementIndex);this.newElement.$wrapper.textArea.attr("id","elements-"+this.elementSetId+"-"+this.newElement.elementIndex);this.newElement.$wrapper.textArea.attr("name","rz[a][a][0]["+this.elementSetId+"][elements]["+this.newElement.elementIndex+"][content]");this.newElement.$wrapper.textArea.val(d);this.newElement.$wrapper.textArea.attr("data-editor",this.mode);this.newElement.$wrapper.elementControls.remove();this.newElement.$wrapper.append(this.getElementActionsMarkUp(this.elementSetId,this.elementSet,this.newElement.elementIndex,false,false))};b.prototype.addAfterOld=function(){this.newElement.$wrapper.hide();this.oldElement.$wrapper.after(this.newElement.$wrapper);this.newElement.$wrapper.slideDown("fast");this.newElement.$wrapper.textArea.focus()};b.prototype.bindClickEvent=function(){c(".element-add").next().find("li").unbind("click").click(function(h){h.preventDefault();var f=c(this).parent().attr("data-index");var d=c(this).parent().attr("data-set");var j=c(this).parent().attr("data-setid");var i=c(this).attr("data-mode");var g=new b(f,d,j,i);g.addNewElementAfterOld()});c(".element-add").next().find("li").find("a").unbind("click").click(function(d){d.preventDefault()});c(".element-delete").unbind("click").click(function(){var f=c(this).attr("data-index");var e=c(this).attr("data-set");var i=c(this).attr("data-setid");var d=c("#elements-"+i+"-"+f);if((d!=undefined&&d.val().length>0)||d==undefined){var h=confirm("Are you sure you want to delete this element?");if(h!=true){return h}}var g=new b(f,e,i);g.oldElement.$wrapper.slideUp("fast",function(){c(this).remove()})});c(".element-pin").unbind("click").click(function(){var d=c(this).attr("data-setid");var e=c(this).attr("data-index");if(c(this).hasClass("active")){c(this).removeClass("active").blur();c("#pined-"+d+"-"+e).val(0);c(this).children("i").removeClass("fa-lock");c(this).children("i").addClass("fa-unlock")}else{c(this).addClass("active").blur();c("#pined-"+d+"-"+e).val(1);c(this).children("i").removeClass("fa-unlock");c(this).children("i").addClass("fa-lock")}});c(".element-disable").unbind("click").click(function(){var d=c(this).attr("data-setid");var e=c(this).attr("data-index");if(c(this).hasClass("active")){c(this).removeClass("active").blur();c("#disabled-"+d+"-"+e).val(0)}else{c(this).addClass("active").blur();c("#disabled-"+d+"-"+e).val(1)}})};b.prototype.updateNextElements=function(){var d=this;this.oldElement.$wrapper.nextAll(".form-group").each(function(f){var j=d.newElement.elementIndex+f;var e=j+1;var i=c(this);i.textAreaWrapper=i.children(".text-area-wrapper");i.textArea=i.textAreaWrapper.children(".text-area");i.elementControls=i.children(".element-control");i.attr("data-index",e);i.attr("id","element-row-"+d.elementSet+"-"+e.toString());i.textArea.attr("id","elements-"+d.elementSetId+"-"+e.toString());i.textArea.attr("name","rz[a][a][0]["+d.elementSetId+"][elements]["+e+"][content]");var h=parseInt(c(this).find("input:regex(id, .*pined.*)").val())==1;var g=parseInt(c(this).find("input:regex(id, .*disabled.*)").val())==1;var k=c(this).find("input:regex(id, .*mode.*)").val();i.elementControls.remove();i.append(d.getElementActionsMarkUp(d.elementSetId,d.elementSet,e,h,g,k))})};b.prototype.getElementActionsMarkUp=function(d,f,l,e,h,j){e=e==undefined?false:e;h=h==undefined?false:h;j=j==undefined?this.mode:j;var i=e?" fa-lock ":" fa-unlock ";var m=e?" active ":"";var k=h?" active ":"";var n=' data-setid="'+d+'" data-set="'+f+'" data-index="'+l+'" ';var g='<div class="col-sm-2 text-center element-control">';g+='<div class="row b-margin-sm">';g+='<div class="col-sm-6">';g+='<button type="button"'+n+'style="font-size: 1em;" class="btn btn-success element-pin'+m+'" title="Pin element">';g+='<i class="fa '+i+'"></i></button>';g+="</div>";g+='<div class="col-sm-6 btn-group">';g+='<button type="button"'+n+'style="font-size: 1em; float: none;" class="btn btn-success element-add dropdown-toggle" title="Add new element"data-toggle="xd-v141226-dev-dropdown"><i class="fa fa-plus"></i></button><ul class="dropdown-menu" '+n+'><li data-mode="html"><a href="#">HTML</a></li><li data-mode="php"><a href="#">PHP</a></li><li data-mode="markdown"><a href="#">Markdown</a></li><li data-mode="javascript"><a href="#">Javascript</a></li><li data-mode="text"><a href="#">Text</a></li></ul>';g+="</div>";g+="</div>";g+='<div class="row">';if(l!=0){g+='<div class="col-sm-6">';g+='<button type="button"'+n+'style="font-size: 1em;" class="btn btn-warning element-disable'+k+'" title="Disable element"><i class="fa fa-power-off"></i></button>';g+="</div>";g+='<div class="col-sm-6">';g+='<button type="button"'+n+'style="font-size: 1em;" class="btn btn-danger element-delete" title="Delete element"><i class="fa fa-trash-o"></i></button>';g+="</div>"}g+="</div>";g+='<input id="pined-'+d+"-"+l+'" class="pined" type="hidden" data-initial-value="" value="'+(e?"1":"0")+'" name="rz[a][a][0]['+d+"][elements]["+l+'][pined]"><input id="disabled-'+d+"-"+l+'" class="pined" type="hidden" data-initial-value="" value="'+(h?"1":"0")+'" name="rz[a][a][0]['+d+"][elements]["+l+'][disabled]"><input id="mode-'+d+"-"+l+'" class="mode" type="hidden" data-initial-value="" value="'+j+'" name="rz[a][a][0]['+d+"][elements]["+l+'][mode]">';g+="</div>";return g};function a(e,d){this.setIdx=e;this.$selector=d}a.prototype={sets:{0:true},bindDeleteEvent:function(){c(".set-delete").unbind("click").click(function(){var f=confirm("Are you sure you want to delete this set?");if(f!=true){return f}var g=parseInt(c(this).attr("data-setidx"));var d=c("#"+c(this).attr("data-setselector"));var e=new a(g,d);e.deleteSet()})},bindAddEvent:function(){c(".set-add").unbind("click").click(function(){var f=parseInt(c(this).attr("data-setidx"));var d=c("#"+c(this).attr("data-setselector"));var e=new a(f,d);e.addNewSet()})},bindEditor:function(e){var h=e.data("editor");var d=parseInt(e.attr("rows"))*25;var f=c("<div>",{position:"absolute",width:"100%",height:d+"px","class":e.attr("class")}).insertBefore(e);e.css("display","none");var g=ace.edit(f[0]);g.renderer.setShowGutter(false);g.getSession().setValue(e.val());g.getSession().setMode("ace/mode/"+h);g.setOptions({enableBasicAutocompletion:true,enableSnippets:true,enableLiveAutocompletion:false});g.setTheme("ace/theme/github");g.getSession().on("change",function(){e.val(g.getSession().getValue())})},addNewSet:function(){a.prototype.bindAddEvent();a.prototype.bindDeleteEvent()},deleteSet:function(){this.$selector.remove();a.prototype.bindAddEvent();a.prototype.bindDeleteEvent()},getAnIdForNewSet:function(){return a.prototype.sets.length+1},setsStashId:function(d){d=parseInt(d);a.prototype.sets[d]=true}};a.prototype.bindAddEvent();a.prototype.bindDeleteEvent();b.prototype.bindClickEvent();ace.require("ace/ext/language_tools");c("textarea[data-editor]").each(function(){a.prototype.bindEditor(c(this))})})(jQuery);