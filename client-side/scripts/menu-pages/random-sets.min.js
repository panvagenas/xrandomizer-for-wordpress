/*
 * Random sets pages script
 *
 * Copyright: Â© 2014
 * {@link http://xdark.eu}
 *
 * @author Panagiotis Vagenas <pan.vagenas@gmail.com>
 * @package Randomizer
 * @since 140914
 */
(function(e){function d(h,g,f){this.elementSet=g.toString();this.elementSetId=f.toString();this.oldElement={};this.oldElement.elementIndex=parseInt(h);this.oldElement.$wrapper=e("#element-row-"+g+"-"+this.oldElement.elementIndex.toString());this.oldElement.$wrapper.textAreaWrapper=this.oldElement.$wrapper.children(".text-area-wrapper");this.oldElement.$wrapper.textArea=this.oldElement.$wrapper.textAreaWrapper.children(".text-area");this.oldElement.$wrapper.elementControls=this.oldElement.$wrapper.children(".element-control");this.newElement={elementIndex:parseInt(h)+1,$wrapper:null}}d.prototype.addNewElementAfterOld=function(){this.formNewElement("");this.updateNextElements();this.addAfterOld();this.bindClickEvent()};d.prototype.formNewElement=function(f){this.newElement.$wrapper=this.oldElement.$wrapper.clone();this.newElement.$wrapper.textAreaWrapper=this.newElement.$wrapper.children(".text-area-wrapper");this.newElement.$wrapper.textArea=this.newElement.$wrapper.textAreaWrapper.children(".text-area");this.newElement.$wrapper.elementControls=this.newElement.$wrapper.children(".element-control");this.newElement.$wrapper.attr("data-index",this.newElement.elementIndex);this.newElement.$wrapper.attr("id","element-row-"+this.elementSet+"-"+this.newElement.elementIndex);this.newElement.$wrapper.textArea.attr("id","elements-"+this.elementSetId+"-"+this.newElement.elementIndex);this.newElement.$wrapper.textArea.attr("name","rz[a][a][0]["+this.elementSetId+"][elements]["+this.newElement.elementIndex+"][content]");this.newElement.$wrapper.textArea.val(f);this.newElement.$wrapper.elementControls.remove();this.newElement.$wrapper.append(this.getElementActionsMarkUp(this.elementSetId,this.elementSet,this.newElement.elementIndex))};d.prototype.addAfterOld=function(){this.newElement.$wrapper.hide();this.oldElement.$wrapper.after(this.newElement.$wrapper);this.newElement.$wrapper.slideDown("fast");this.newElement.$wrapper.textArea.focus()};d.prototype.bindClickEvent=function(){e(".element-add").unbind("click").click(function(){var g=e(this).attr("data-index");var f=e(this).attr("data-set");var i=e(this).attr("data-setid");var h=new d(g,f,i);h.addNewElementAfterOld()});e(".element-delete").unbind("click").click(function(){var h=e(this).attr("data-index");var g=e(this).attr("data-set");var k=e(this).attr("data-setid");var f=e("#elements-"+k+"-"+h);if((f!=undefined&&f.val().length>0)||f==undefined){var j=confirm("Are you sure you want to delete this element?");if(j!=true){return j}}var i=new d(h,g,k);i.oldElement.$wrapper.slideUp("fast",function(){e(this).remove()})});e(".element-pin").unbind("click").click(function(){var f=e(this).attr("data-setid");var g=e(this).attr("data-index");if(e(this).hasClass("active")){e(this).removeClass("active").blur();e("#pined-"+f+"-"+g).val(0);e(this).children("i").removeClass("fa-lock");e(this).children("i").addClass("fa-unlock")}else{e(this).addClass("active").blur();e("#pined-"+f+"-"+g).val(1);e(this).children("i").removeClass("fa-unlock");e(this).children("i").addClass("fa-lock")}});e(".element-disable").unbind("click").click(function(){var f=e(this).attr("data-setid");var g=e(this).attr("data-index");if(e(this).hasClass("active")){e(this).removeClass("active").blur();e("#disabled-"+f+"-"+g).val(0)}else{e(this).addClass("active").blur();e("#disabled-"+f+"-"+g).val(1)}})};d.prototype.updateNextElements=function(){var f=this;this.oldElement.$wrapper.nextAll(".form-group").each(function(h){var l=f.newElement.elementIndex+h;var g=l+1;var k=e(this);k.textAreaWrapper=k.children(".text-area-wrapper");k.textArea=k.textAreaWrapper.children(".text-area");k.elementControls=k.children(".element-control");k.attr("data-index",g);k.attr("id","element-row-"+f.elementSet+"-"+g.toString());k.textArea.attr("id","elements-"+f.elementSetId+"-"+g.toString());k.textArea.attr("name","rz[a][a][0]["+f.elementSetId+"][elements]["+g+"][content]");var j=parseInt(e(this).find("input:regex(id, .*pined.*)").val())==1;var i=parseInt(e(this).find("input:regex(id, .*disabled.*)").val())==1;k.elementControls.remove();k.append(f.getElementActionsMarkUp(f.elementSetId,f.elementSet,g,j,i))})};d.prototype.getElementActionsMarkUp=function(f,h,l,g,j){g=g==undefined?false:g;j=j==undefined?false:j;var k=g?" fa-lock ":" fa-unlock ";var n=g?" active ":"";var m=j?" active ":"";var o=' data-setid="'+f+'" data-set="'+h+'" data-index="'+l+'" ';var i='<div class="col-sm-2 text-center element-control">';i+='<div class="row b-margin-sm">';i+='<div class="col-sm-6">';i+='<button type="button"'+o+'style="font-size: 1em;" class="btn btn-success element-pin'+n+'" title="Pin element">';i+='<i class="fa '+k+'"></i></button>';i+="</div>";i+='<div class="col-sm-6">';i+='<button type="button"'+o+'style="font-size: 1em; " class="btn btn-success element-add" title="Add new element"><i class="fa fa-plus"></i></button>';i+="</div>";i+="</div>";i+='<div class="row">';if(l!=0){i+='<div class="col-sm-6">';i+='<button type="button"'+o+'style="font-size: 1em;" class="btn btn-warning element-disable'+m+'" title="Disable element"><i class="fa fa-power-off"></i></button>';i+="</div>";i+='<div class="col-sm-6">';i+='<button type="button"'+o+'style="font-size: 1em;" class="btn btn-danger element-delete" title="Delete element"><i class="fa fa-trash-o"></i></button>';i+="</div>"}i+="</div>";i+='<input id="pined-'+f+"-"+l+'" class="pined" type="hidden" data-initial-value="" value="'+(g?"1":"0")+'" name="rz[a][a][0]['+f+"][elements]["+l+'][pined]"><input id="disabled-'+f+"-"+l+'" class="pined" type="hidden" data-initial-value="" value="'+(j?"1":"0")+'" name="rz[a][a][0]['+f+"][elements]["+l+'][disabled]">';i+="</div>";return i};function a(g,f){this.setIdx=g;this.$selector=f}a.prototype={sets:{0:true},bindDeleteEvent:function(){e(".set-delete").unbind("click").click(function(){var h=confirm("Are you sure you want to delete this set?");if(h!=true){return h}var i=parseInt(e(this).attr("data-setidx"));var f=e("#"+e(this).attr("data-setselector"));var g=new a(i,f);g.deleteSet()})},bindAddEvent:function(){e(".set-add").unbind("click").click(function(){var h=parseInt(e(this).attr("data-setidx"));var f=e("#"+e(this).attr("data-setselector"));var g=new a(h,f);g.addNewSet()})},addNewSet:function(){a.prototype.bindAddEvent();a.prototype.bindDeleteEvent()},deleteSet:function(){this.$selector.remove();a.prototype.bindAddEvent();a.prototype.bindDeleteEvent()},getAnIdForNewSet:function(){return a.prototype.sets.length+1},setsStashId:function(f){f=parseInt(f);a.prototype.sets[f]=true}};a.prototype.bindAddEvent();a.prototype.bindDeleteEvent();d.prototype.bindClickEvent();var b;var c=ace.edit("editor");c.setTheme("ace/theme/github");c.getSession().setMode("ace/mode/html");e(".element-text-area").focus(function(){e("#launch-modal").trigger("click");c.setValue(" ");c.setValue(e(this).val());c.gotoLine(c.session.getLength());c.focus();b=e(this)});e("#modal-btn-update").click(function(){b.val(c.getValue());c.setValue(" ")});e("#modal-btn-close").click(function(){c.setValue(" ")})})(jQuery);