/*
 * Random sets pages script
 *
 * Copyright: © 2014
 * {@link http://TODO WebSharks™}
 *
 * @author Panagiotis Vagenas <pan.vagenas@gmail.com>
 * @package Randomizer
 * @since 140914
 */
(function(c){function b(f,e,d){this.elementSet=e.toString();this.elementSetId=d.toString();this.oldElement={};this.oldElement.elementIndex=parseInt(f);this.oldElement.$wrapper=c("#element-row-"+e+"-"+this.oldElement.elementIndex.toString());this.oldElement.$wrapper.textAreaWrapper=this.oldElement.$wrapper.children(".text-area-wrapper");this.oldElement.$wrapper.textArea=this.oldElement.$wrapper.textAreaWrapper.children(".text-area");this.oldElement.$wrapper.elementControls=this.oldElement.$wrapper.children(".element-control");this.newElement={elementIndex:parseInt(f)+1,$wrapper:null}}b.prototype.addNewElementAfterOld=function(){this.formNewElement("");this.updateNextElements();this.addAfterOld();this.bindClickEvent()};b.prototype.formNewElement=function(d){this.newElement.$wrapper=this.oldElement.$wrapper.clone();this.newElement.$wrapper.textAreaWrapper=this.newElement.$wrapper.children(".text-area-wrapper");this.newElement.$wrapper.textArea=this.newElement.$wrapper.textAreaWrapper.children(".text-area");this.newElement.$wrapper.elementControls=this.newElement.$wrapper.children(".element-control");this.newElement.$wrapper.attr("data-index",this.newElement.elementIndex);this.newElement.$wrapper.attr("id","element-row-"+this.elementSet+"-"+this.newElement.elementIndex);this.newElement.$wrapper.textArea.attr("id","elements-"+this.elementSetId+"-"+this.newElement.elementIndex);this.newElement.$wrapper.textArea.attr("name","rz[a][a][0]["+this.elementSetId+"][elements]["+this.newElement.elementIndex+"][content]");this.newElement.$wrapper.textArea.val(d);this.newElement.$wrapper.elementControls.remove();this.newElement.$wrapper.append(this.getElementActionsMarkUp(this.elementSetId,this.elementSet,this.newElement.elementIndex))};b.prototype.addAfterOld=function(){this.newElement.$wrapper.hide();this.oldElement.$wrapper.after(this.newElement.$wrapper);this.newElement.$wrapper.slideDown("fast");this.newElement.$wrapper.textArea.focus()};b.prototype.bindClickEvent=function(){c(".element-add").unbind("click").click(function(){var e=c(this).attr("data-index");var d=c(this).attr("data-set");var g=c(this).attr("data-setid");var f=new b(e,d,g);f.addNewElementAfterOld()});c(".element-delete").unbind("click").click(function(){var f=c(this).attr("data-index");var e=c(this).attr("data-set");var i=c(this).attr("data-setid");var d=c("#elements-"+i+"-"+f);if((d!=undefined&&d.val().length>0)||d==undefined){var h=confirm("Are you sure you want to delete this element?");if(h!=true){return h}}var g=new b(f,e,i);g.oldElement.$wrapper.slideUp("fast",function(){c(this).remove()})});c(".element-pin").unbind("click").click(function(){var d=c(this).attr("data-setid");var e=c(this).attr("data-index");if(c(this).hasClass("active")){c(this).removeClass("active").blur();c("#pined-"+d+"-"+e).val(0);c(this).children("i").removeClass("fa-lock");c(this).children("i").addClass("fa-unlock")}else{c(this).addClass("active").blur();c("#pined-"+d+"-"+e).val(1);c(this).children("i").removeClass("fa-unlock");c(this).children("i").addClass("fa-lock")}});c(".element-disable").unbind("click").click(function(){var d=c(this).attr("data-setid");var e=c(this).attr("data-index");if(c(this).hasClass("active")){c(this).removeClass("active").blur();c("#disabled-"+d+"-"+e).val(0)}else{c(this).addClass("active").blur();c("#disabled-"+d+"-"+e).val(1)}})};b.prototype.updateNextElements=function(){var d=this;this.oldElement.$wrapper.nextAll(".form-group").each(function(f){var j=d.newElement.elementIndex+f;var e=j+1;var i=c(this);i.textAreaWrapper=i.children(".text-area-wrapper");i.textArea=i.textAreaWrapper.children(".text-area");i.elementControls=i.children(".element-control");i.attr("data-index",e);i.attr("id","element-row-"+d.elementSet+"-"+e.toString());i.textArea.attr("id","elements-"+d.elementSetId+"-"+e.toString());i.textArea.attr("name","rz[a][a][0]["+d.elementSetId+"][elements]["+e+"][content]");var h=parseInt(c(this).find("input:regex(id, .*pined.*)").val())==1;var g=parseInt(c(this).find("input:regex(id, .*disabled.*)").val())==1;i.elementControls.remove();i.append(d.getElementActionsMarkUp(d.elementSetId,d.elementSet,e,h,g))})};b.prototype.getElementActionsMarkUp=function(d,f,j,e,h){e=e==undefined?false:e;h=h==undefined?false:h;var i=e?" fa-lock ":" fa-unlock ";var l=e?" active ":"";var k=h?" active ":"";var m=' data-setid="'+d+'" data-set="'+f+'" data-index="'+j+'" ';var g='<div class="col-sm-2 text-center element-control">';g+='<div class="row b-margin-sm">';g+='<div class="col-sm-6">';g+='<button type="button"'+m+'style="font-size: 1em;" class="btn btn-success element-pin'+l+'" title="Pin element">';g+='<i class="fa '+i+'"></i></button>';g+="</div>";g+='<div class="col-sm-6">';g+='<button type="button"'+m+'style="font-size: 1em; " class="btn btn-success element-add" title="Add new element"><i class="fa fa-plus"></i></button>';g+="</div>";g+="</div>";g+='<div class="row">';if(j!=0){g+='<div class="col-sm-6">';g+='<button type="button"'+m+'style="font-size: 1em;" class="btn btn-warning element-disable'+k+'" title="Disable element"><i class="fa fa-power-off"></i></button>';g+="</div>";g+='<div class="col-sm-6">';g+='<button type="button"'+m+'style="font-size: 1em;" class="btn btn-danger element-delete" title="Delete element"><i class="fa fa-trash-o"></i></button>';g+="</div>"}g+="</div>";g+='<input id="pined-'+d+"-"+j+'" class="pined" type="hidden" data-initial-value="" value="'+(e?"1":"0")+'" name="rz[a][a][0]['+d+"][elements]["+j+'][pined]"><input id="disabled-'+d+"-"+j+'" class="pined" type="hidden" data-initial-value="" value="'+(h?"1":"0")+'" name="rz[a][a][0]['+d+"][elements]["+j+'][disabled]">';g+="</div>";return g};function a(e,d){this.setIdx=e;this.$selector=d}a.prototype={sets:{0:true},bindDeleteEvent:function(){c(".set-delete").unbind("click").click(function(){var f=confirm("Are you sure you want to delete this set?");if(f!=true){return f}var g=parseInt(c(this).attr("data-setidx"));var d=c("#"+c(this).attr("data-setselector"));var e=new a(g,d);e.deleteSet()})},bindAddEvent:function(){c(".set-add").unbind("click").click(function(){var f=parseInt(c(this).attr("data-setidx"));var d=c("#"+c(this).attr("data-setselector"));var e=new a(f,d);e.addNewSet()})},addNewSet:function(){a.prototype.bindAddEvent();a.prototype.bindDeleteEvent()},deleteSet:function(){this.$selector.remove();a.prototype.bindAddEvent();a.prototype.bindDeleteEvent()},getAnIdForNewSet:function(){return a.prototype.sets.length+1},setsStashId:function(d){d=parseInt(d);a.prototype.sets[d]=true}};a.prototype.bindAddEvent();a.prototype.bindDeleteEvent();b.prototype.bindClickEvent()})(jQuery);